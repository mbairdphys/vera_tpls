<center><a href="arkimex.c">Actual source code: arkimex.c</a></center><br>

<html>
<head> <link rel="canonical" href="http://www.mcs.anl.gov/petsc/petsc-current/src/ts/impls/arkimex/arkimex.c.html" />
<title></title>
<meta name="generator" content="c2html 0.9.4">
<meta name="date" content="2016-04-12T16:51:12+00:00">
</head>

<body bgcolor="#FFFFFF">
   <div id="version" align=right><b>petsc-3.6.4 2016-04-12</b></div>
   <div id="bugreport" align=right><a href="mailto:petsc-maint@mcs.anl.gov?subject=Typo or Error in Documentation &body=Please describe the typo or error in the documentation: petsc-3.6.4 v3.6.4 src/ts/impls/arkimex/arkimex.c.html "><small>Report Typos and Errors</small></a></div>
<pre width="80"><a name="line1">  1: </a><font color="#B22222">/*</font>
<a name="line2">  2: </a><font color="#B22222">  Code for timestepping with additive Runge-Kutta IMEX method</font>

<a name="line4">  4: </a><font color="#B22222">  Notes:</font>
<a name="line5">  5: </a><font color="#B22222">  The general system is written as</font>

<a name="line7">  7: </a><font color="#B22222">  F(t,U,Udot) = G(t,U)</font>

<a name="line9">  9: </a><font color="#B22222">  where F represents the stiff part of the physics and G represents the non-stiff part.</font>

<a name="line11"> 11: </a><font color="#B22222">*/</font>
<a name="line12"> 12: </a><font color="#A020F0">#include &lt;petsc/private/tsimpl.h&gt;                </font><font color="#B22222">/*I   "petscts.h"   I*/</font><font color="#A020F0"></font>
<a name="line13"> 13: </a><font color="#A020F0">#include &lt;petscdm.h&gt;</font>

<a name="line15"> 15: </a>static <a href="../../../../docs/manualpages/TS/TSARKIMEXType.html#TSARKIMEXType">TSARKIMEXType</a>  TSARKIMEXDefault = <a href="../../../../docs/manualpages/TS/TSARKIMEX3.html#TSARKIMEX3">TSARKIMEX3</a>;
<a name="line16"> 16: </a>static <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      TSARKIMEXRegisterAllCalled;
<a name="line17"> 17: </a>static <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      TSARKIMEXPackageInitialized;
<a name="line18"> 18: </a>static <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       explicit_stage_time_id;
<a name="line19"> 19: </a><strong><font color="#4169E1">static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSExtrapolate_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>,<a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>)</font></strong>;

<a name="line21"> 21: </a><font color="#4169E1">typedef struct _ARKTableau *ARKTableau;</font>
<a name="line22"> 22: </a><font color="#4169E1"><a name="_ARKTableau"></a>struct _ARKTableau </font>{
<a name="line23"> 23: </a>  char      *name;
<a name="line24"> 24: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>  order;                <font color="#B22222">/* Classical approximation order of the method */</font>
<a name="line25"> 25: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>  s;                    <font color="#B22222">/* Number of stages */</font>
<a name="line26"> 26: </a>  <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> stiffly_accurate;     <font color="#B22222">/* The implicit part is stiffly accurate*/</font>
<a name="line27"> 27: </a>  <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> FSAL_implicit;        <font color="#B22222">/* The implicit part is FSAL*/</font>
<a name="line28"> 28: </a>  <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> explicit_first_stage; <font color="#B22222">/* The implicit part has an explicit first stage*/</font>
<a name="line29"> 29: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>  pinterp;              <font color="#B22222">/* Interpolation order */</font>
<a name="line30"> 30: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *At,*bt,*ct;          <font color="#B22222">/* Stiff tableau */</font>
<a name="line31"> 31: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *A,*b,*c;             <font color="#B22222">/* Non-stiff tableau */</font>
<a name="line32"> 32: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *bembedt,*bembed;     <font color="#B22222">/* Embedded formula of order one less (order-1) */</font>
<a name="line33"> 33: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *binterpt,*binterp;   <font color="#B22222">/* Dense output formula */</font>
<a name="line34"> 34: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> ccfl;                 <font color="#B22222">/* Placeholder for CFL coefficient relative to forward Euler */</font>
<a name="line35"> 35: </a>};
<a name="line36"> 36: </a><font color="#4169E1">typedef struct _ARKTableauLink *ARKTableauLink;</font>
<a name="line37"> 37: </a><font color="#4169E1"><a name="_ARKTableauLink"></a>struct _ARKTableauLink </font>{
<a name="line38"> 38: </a>  <font color="#4169E1">struct _ARKTableau</font> tab;
<a name="line39"> 39: </a>  ARKTableauLink     next;
<a name="line40"> 40: </a>};
<a name="line41"> 41: </a>static ARKTableauLink ARKTableauList;

<a name="line43"> 43: </a><font color="#4169E1">typedef</font> <font color="#4169E1">struct</font> {
<a name="line44"> 44: </a>  ARKTableau   tableau;
<a name="line45"> 45: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>          *Y;               <font color="#B22222">/* States computed during the step */</font>
<a name="line46"> 46: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>          *YdotI;           <font color="#B22222">/* Time derivatives for the stiff part */</font>
<a name="line47"> 47: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>          *YdotRHS;         <font color="#B22222">/* Function evaluations for the non-stiff part */</font>
<a name="line48"> 48: </a>  <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>    prev_step_valid;  <font color="#B22222">/* Stored previous step (Y_prev, YdotI_prev, YdotRHS_prev) is valid */</font>
<a name="line49"> 49: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>          *Y_prev;          <font color="#B22222">/* States computed during the previous time step */</font>
<a name="line50"> 50: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>          *YdotI_prev;      <font color="#B22222">/* Time derivatives for the stiff part for the previous time step*/</font>
<a name="line51"> 51: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>          *YdotRHS_prev;    <font color="#B22222">/* Function evaluations for the non-stiff part for the previous time step*/</font>
<a name="line52"> 52: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>          Ydot0;            <font color="#B22222">/* Holds the slope from the previous step in FSAL case */</font>
<a name="line53"> 53: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>          Ydot;             <font color="#B22222">/* Work vector holding Ydot during residual evaluation */</font>
<a name="line54"> 54: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>          Work;             <font color="#B22222">/* Generic work vector */</font>
<a name="line55"> 55: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>          Z;                <font color="#B22222">/* Ydot = shift(Y-Z) */</font>
<a name="line56"> 56: </a>  <a href="../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a>  *work;            <font color="#B22222">/* Scalar work */</font>
<a name="line57"> 57: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>    scoeff;           <font color="#B22222">/* shift = scoeff/dt */</font>
<a name="line58"> 58: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>    stage_time;
<a name="line59"> 59: </a>  <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>    imex;
<a name="line60"> 60: </a>  <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>    init_guess_extrp; <font color="#B22222">/* Extrapolate initial guess from previous time-step stage values */</font>
<a name="line61"> 61: </a>  TSStepStatus status;
<a name="line62"> 62: </a>} TS_ARKIMEX;
<a name="line63"> 63: </a><font color="#B22222">/*MC</font>
<a name="line64"> 64: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEXARS122.html#TSARKIMEXARS122">TSARKIMEXARS122</a> - Second order ARK IMEX scheme.</font>

<a name="line66"> 66: </a><font color="#B22222">     This method has one explicit stage and one implicit stage.</font>

<a name="line68"> 68: </a><font color="#B22222">     References:</font>
<a name="line69"> 69: </a><font color="#B22222">     U. Ascher, S. Ruuth, R. J. Spiteri, Implicit-explicit Runge-Kutta methods for time dependent Partial Differential Equations. Appl. Numer. Math. 25, (1997), pp. 151-167.</font>

<a name="line71"> 71: </a><font color="#B22222">     Level: advanced</font>

<a name="line73"> 73: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line74"> 74: </a><font color="#B22222">M*/</font>
<a name="line75"> 75: </a><font color="#B22222">/*MC</font>
<a name="line76"> 76: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEXA2.html#TSARKIMEXA2">TSARKIMEXA2</a> - Second order ARK IMEX scheme with A-stable implicit part.</font>

<a name="line78"> 78: </a><font color="#B22222">     This method has an explicit stage and one implicit stage, and has an A-stable implicit scheme. This method was provided by Emil Constantinescu.</font>

<a name="line80"> 80: </a><font color="#B22222">     Level: advanced</font>

<a name="line82"> 82: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line83"> 83: </a><font color="#B22222">M*/</font>
<a name="line84"> 84: </a><font color="#B22222">/*MC</font>
<a name="line85"> 85: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEXL2.html#TSARKIMEXL2">TSARKIMEXL2</a> - Second order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line87"> 87: </a><font color="#B22222">     This method has two implicit stages, and L-stable implicit scheme.</font>

<a name="line89"> 89: </a><font color="#B22222">    References:</font>
<a name="line90"> 90: </a><font color="#B22222">     L. Pareschi, G. Russo, Implicit-Explicit Runge-Kutta schemes and applications to hyperbolic systems with relaxations. Journal of Scientific Computing Volume: 25, Issue: 1, October, 2005, pp. 129-155</font>

<a name="line92"> 92: </a><font color="#B22222">     Level: advanced</font>

<a name="line94"> 94: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line95"> 95: </a><font color="#B22222">M*/</font>
<a name="line96"> 96: </a><font color="#B22222">/*MC</font>
<a name="line97"> 97: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEX1BEE.html#TSARKIMEX1BEE">TSARKIMEX1BEE</a> - First order Backward Euler represented as an ARK IMEX scheme with extrapolation as error estimator. This is a 3-stage method.</font>

<a name="line99"> 99: </a><font color="#B22222">     This method is aimed at starting the integration of implicit DAEs when explicit first-stage ARK methods are used.</font>

<a name="line101">101: </a><font color="#B22222">     Level: advanced</font>

<a name="line103">103: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line104">104: </a><font color="#B22222">M*/</font>
<a name="line105">105: </a><font color="#B22222">/*MC</font>
<a name="line106">106: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEX2C.html#TSARKIMEX2C">TSARKIMEX2C</a> - Second order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line108">108: </a><font color="#B22222">     This method has one explicit stage and two implicit stages. The implicit part is the same as in <a href="../../../../docs/manualpages/TS/TSARKIMEX2D.html#TSARKIMEX2D">TSARKIMEX2D</a> and <a href="../../../../docs/manualpages/TS/TSARKIMEX2E.html#TSARKIMEX2E">TSARKIMEX2E</a>, but the explicit part has a larger stability region on the negative real axis. This method was provided by Emil Constantinescu.</font>

<a name="line110">110: </a><font color="#B22222">     Level: advanced</font>

<a name="line112">112: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line113">113: </a><font color="#B22222">M*/</font>
<a name="line114">114: </a><font color="#B22222">/*MC</font>
<a name="line115">115: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEX2D.html#TSARKIMEX2D">TSARKIMEX2D</a> - Second order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line117">117: </a><font color="#B22222">     This method has one explicit stage and two implicit stages. The stability function is independent of the explicit part in the infinity limit of the implict component. This method was provided by Emil Constantinescu.</font>

<a name="line119">119: </a><font color="#B22222">     Level: advanced</font>

<a name="line121">121: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line122">122: </a><font color="#B22222">M*/</font>
<a name="line123">123: </a><font color="#B22222">/*MC</font>
<a name="line124">124: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEX2E.html#TSARKIMEX2E">TSARKIMEX2E</a> - Second order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line126">126: </a><font color="#B22222">     This method has one explicit stage and two implicit stages. It is is an optimal method developed by Emil Constantinescu.</font>

<a name="line128">128: </a><font color="#B22222">     Level: advanced</font>

<a name="line130">130: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line131">131: </a><font color="#B22222">M*/</font>
<a name="line132">132: </a><font color="#B22222">/*MC</font>
<a name="line133">133: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEXPRSSP2.html#TSARKIMEXPRSSP2">TSARKIMEXPRSSP2</a> - Second order SSP ARK IMEX scheme.</font>

<a name="line135">135: </a><font color="#B22222">     This method has three implicit stages.</font>

<a name="line137">137: </a><font color="#B22222">     References:</font>
<a name="line138">138: </a><font color="#B22222">     L. Pareschi, G. Russo, Implicit-Explicit Runge-Kutta schemes and applications to hyperbolic systems with relaxations. Journal of Scientific Computing Volume: 25, Issue: 1, October, 2005, pp. 129-155</font>

<a name="line140">140: </a><font color="#B22222">     This method is referred to as SSP2-(3,3,2) in http://arxiv.org/abs/1110.4375</font>

<a name="line142">142: </a><font color="#B22222">     Level: advanced</font>

<a name="line144">144: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line145">145: </a><font color="#B22222">M*/</font>
<a name="line146">146: </a><font color="#B22222">/*MC</font>
<a name="line147">147: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEX3.html#TSARKIMEX3">TSARKIMEX3</a> - Third order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line149">149: </a><font color="#B22222">     This method has one explicit stage and three implicit stages.</font>

<a name="line151">151: </a><font color="#B22222">     References:</font>
<a name="line152">152: </a><font color="#B22222">     Kennedy and Carpenter 2003.</font>

<a name="line154">154: </a><font color="#B22222">     Level: advanced</font>

<a name="line156">156: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line157">157: </a><font color="#B22222">M*/</font>
<a name="line158">158: </a><font color="#B22222">/*MC</font>
<a name="line159">159: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEXARS443.html#TSARKIMEXARS443">TSARKIMEXARS443</a> - Third order ARK IMEX scheme.</font>

<a name="line161">161: </a><font color="#B22222">     This method has one explicit stage and four implicit stages.</font>

<a name="line163">163: </a><font color="#B22222">     References:</font>
<a name="line164">164: </a><font color="#B22222">     U. Ascher, S. Ruuth, R. J. Spiteri, Implicit-explicit Runge-Kutta methods for time dependent Partial Differential Equations. Appl. Numer. Math. 25, (1997), pp. 151-167.</font>

<a name="line166">166: </a><font color="#B22222">     This method is referred to as ARS(4,4,3) in http://arxiv.org/abs/1110.4375</font>

<a name="line168">168: </a><font color="#B22222">     Level: advanced</font>

<a name="line170">170: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line171">171: </a><font color="#B22222">M*/</font>
<a name="line172">172: </a><font color="#B22222">/*MC</font>
<a name="line173">173: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEXBPR3.html#TSARKIMEXBPR3">TSARKIMEXBPR3</a> - Third order ARK IMEX scheme.</font>

<a name="line175">175: </a><font color="#B22222">     This method has one explicit stage and four implicit stages.</font>

<a name="line177">177: </a><font color="#B22222">     References:</font>
<a name="line178">178: </a><font color="#B22222">     This method is referred to as ARK3 in http://arxiv.org/abs/1110.4375</font>

<a name="line180">180: </a><font color="#B22222">     Level: advanced</font>

<a name="line182">182: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line183">183: </a><font color="#B22222">M*/</font>
<a name="line184">184: </a><font color="#B22222">/*MC</font>
<a name="line185">185: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEX4.html#TSARKIMEX4">TSARKIMEX4</a> - Fourth order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line187">187: </a><font color="#B22222">     This method has one explicit stage and four implicit stages.</font>

<a name="line189">189: </a><font color="#B22222">     References:</font>
<a name="line190">190: </a><font color="#B22222">     Kennedy and Carpenter 2003.</font>

<a name="line192">192: </a><font color="#B22222">     Level: advanced</font>

<a name="line194">194: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line195">195: </a><font color="#B22222">M*/</font>
<a name="line196">196: </a><font color="#B22222">/*MC</font>
<a name="line197">197: </a><font color="#B22222">     <a href="../../../../docs/manualpages/TS/TSARKIMEX5.html#TSARKIMEX5">TSARKIMEX5</a> - Fifth order ARK IMEX scheme with L-stable implicit part.</font>

<a name="line199">199: </a><font color="#B22222">     This method has one explicit stage and five implicit stages.</font>

<a name="line201">201: </a><font color="#B22222">     References:</font>
<a name="line202">202: </a><font color="#B22222">     Kennedy and Carpenter 2003.</font>

<a name="line204">204: </a><font color="#B22222">     Level: advanced</font>

<a name="line206">206: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line207">207: </a><font color="#B22222">M*/</font>

<a name="line211">211: </a><font color="#B22222">/*@C</font>
<a name="line212">212: </a><font color="#B22222">  <a href="../../../../docs/manualpages/TS/TSARKIMEXRegisterAll.html#TSARKIMEXRegisterAll">TSARKIMEXRegisterAll</a> - Registers all of the additive Runge-Kutta implicit-explicit methods in <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>

<a name="line214">214: </a><font color="#B22222">  Not Collective, but should be called by all processes which will need the schemes to be registered</font>

<a name="line216">216: </a><font color="#B22222">  Level: advanced</font>

<a name="line218">218: </a><font color="#B22222">.keywords: <a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a>, register, all</font>

<a name="line220">220: </a><font color="#B22222">.seealso:  <a href="../../../../docs/manualpages/TS/TSARKIMEXRegisterDestroy.html#TSARKIMEXRegisterDestroy">TSARKIMEXRegisterDestroy</a>()</font>
<a name="line221">221: </a><font color="#B22222">@*/</font>
<a name="line222">222: </a><strong><font color="#4169E1"><a name="TSARKIMEXRegisterAll"></a><a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../docs/manualpages/TS/TSARKIMEXRegisterAll.html#TSARKIMEXRegisterAll">TSARKIMEXRegisterAll</a>(void)</font></strong>
<a name="line223">223: </a>{

<a name="line227">227: </a>  <font color="#4169E1">if</font> (TSARKIMEXRegisterAllCalled) <font color="#4169E1">return</font>(0);
<a name="line228">228: </a>  TSARKIMEXRegisterAllCalled = <a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;

<a name="line230">230: </a>  {
<a name="line231">231: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line232">232: </a>      A[3][3] = {{0.0,0.0,0.0},
<a name="line233">233: </a>                 {0.0,0.0,0.0},
<a name="line234">234: </a>                 {0.0,0.5,0.0}},
<a name="line235">235: </a>      At[3][3] = {{1.0,0.0,0.0},
<a name="line236">236: </a>                  {0.0,0.5,0.0},
<a name="line237">237: </a>                  {0.0,0.5,0.5}},
<a name="line238">238: </a>      b[3]       = {0.0,0.5,0.5},
<a name="line239">239: </a>      bembedt[3] = {1.0,0.0,0.0};
<a name="line240">240: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEX1BEE.html#TSARKIMEX1BEE">TSARKIMEX1BEE</a>,2,3,&amp;At[0][0],b,NULL,&amp;A[0][0],b,NULL,bembedt,bembedt,1,b,NULL);
<a name="line241">241: </a>  }
<a name="line242">242: </a>  {
<a name="line243">243: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line244">244: </a>      A[2][2] = {{0.0,0.0},
<a name="line245">245: </a>                 {0.5,0.0}},
<a name="line246">246: </a>      At[2][2] = {{0.0,0.0},
<a name="line247">247: </a>                  {0.0,0.5}},
<a name="line248">248: </a>      b[2]       = {0.0,1.0},
<a name="line249">249: </a>      bembedt[2] = {0.5,0.5};
<a name="line250">250: </a>    <font color="#B22222">/* binterpt[2][2] = {{1.0,-1.0},{0.0,1.0}};  second order dense output has poor stability properties and hence it is not currently in use*/</font>
<a name="line251">251: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEXARS122.html#TSARKIMEXARS122">TSARKIMEXARS122</a>,2,2,&amp;At[0][0],b,NULL,&amp;A[0][0],b,NULL,bembedt,bembedt,1,b,NULL);
<a name="line252">252: </a>  }
<a name="line253">253: </a>  {
<a name="line254">254: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line255">255: </a>      A[2][2] = {{0.0,0.0},
<a name="line256">256: </a>                 {1.0,0.0}},
<a name="line257">257: </a>      At[2][2] = {{0.0,0.0},
<a name="line258">258: </a>                  {0.5,0.5}},
<a name="line259">259: </a>      b[2]       = {0.5,0.5},
<a name="line260">260: </a>      bembedt[2] = {0.0,1.0};
<a name="line261">261: </a>    <font color="#B22222">/* binterpt[2][2] = {{1.0,-0.5},{0.0,0.5}}  second order dense output has poor stability properties and hence it is not currently in use*/</font>
<a name="line262">262: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEXA2.html#TSARKIMEXA2">TSARKIMEXA2</a>,2,2,&amp;At[0][0],b,NULL,&amp;A[0][0],b,NULL,bembedt,bembedt,1,b,NULL);
<a name="line263">263: </a>  }
<a name="line264">264: </a>  {
<a name="line265">265: </a>    <font color="#B22222">/* const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> us2 = 1.0-1.0/PetscSqrtReal((<a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>)2.0);    Direct evaluation: 0.2928932188134524755992. Used below to ensure all values are available at compile time   */</font>
<a name="line266">266: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line267">267: </a>      A[2][2] = {{0.0,0.0},
<a name="line268">268: </a>                 {1.0,0.0}},
<a name="line269">269: </a>      At[2][2] = {{0.2928932188134524755992,0.0},
<a name="line270">270: </a>                  {1.0-2.0*0.2928932188134524755992,0.2928932188134524755992}},
<a name="line271">271: </a>      b[2]       = {0.5,0.5},
<a name="line272">272: </a>      bembedt[2] = {0.0,1.0},
<a name="line273">273: </a>      binterpt[2][2] = {{  (0.2928932188134524755992-1.0)/(2.0*0.2928932188134524755992-1.0),-1/(2.0*(1.0-2.0*0.2928932188134524755992))},
<a name="line274">274: </a>                        {1-(0.2928932188134524755992-1.0)/(2.0*0.2928932188134524755992-1.0),-1/(2.0*(1.0-2.0*0.2928932188134524755992))}},
<a name="line275">275: </a>      binterp[2][2] = {{1.0,-0.5},{0.0,0.5}};
<a name="line276">276: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEXL2.html#TSARKIMEXL2">TSARKIMEXL2</a>,2,2,&amp;At[0][0],b,NULL,&amp;A[0][0],b,NULL,bembedt,bembedt,2,binterpt[0],binterp[0]);
<a name="line277">277: </a>  }
<a name="line278">278: </a>  {
<a name="line279">279: </a>    <font color="#B22222">/* const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> s2 = PetscSqrtReal((<a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>)2.0),  Direct evaluation: 1.414213562373095048802. Used below to ensure all values are available at compile time   */</font>
<a name="line280">280: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line281">281: </a>      A[3][3] = {{0,0,0},
<a name="line282">282: </a>                 {2-1.414213562373095048802,0,0},
<a name="line283">283: </a>                 {0.5,0.5,0}},
<a name="line284">284: </a>      At[3][3] = {{0,0,0},
<a name="line285">285: </a>                  {1-1/1.414213562373095048802,1-1/1.414213562373095048802,0},
<a name="line286">286: </a>                  {1/(2*1.414213562373095048802),1/(2*1.414213562373095048802),1-1/1.414213562373095048802}},
<a name="line287">287: </a>      bembedt[3] = {(4.-1.414213562373095048802)/8.,(4.-1.414213562373095048802)/8.,1/(2.*1.414213562373095048802)},
<a name="line288">288: </a>      binterpt[3][2] = {{1.0/1.414213562373095048802,-1.0/(2.0*1.414213562373095048802)},
<a name="line289">289: </a>                        {1.0/1.414213562373095048802,-1.0/(2.0*1.414213562373095048802)},
<a name="line290">290: </a>                        {1.0-1.414213562373095048802,1.0/1.414213562373095048802}};
<a name="line291">291: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEX2C.html#TSARKIMEX2C">TSARKIMEX2C</a>,2,3,&amp;At[0][0],NULL,NULL,&amp;A[0][0],NULL,NULL,bembedt,bembedt,2,binterpt[0],NULL);
<a name="line292">292: </a>  }
<a name="line293">293: </a>  {
<a name="line294">294: </a>    <font color="#B22222">/* const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> s2 = PetscSqrtReal((<a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>)2.0),  Direct evaluation: 1.414213562373095048802. Used below to ensure all values are available at compile time   */</font>
<a name="line295">295: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line296">296: </a>      A[3][3] = {{0,0,0},
<a name="line297">297: </a>                 {2-1.414213562373095048802,0,0},
<a name="line298">298: </a>                 {0.75,0.25,0}},
<a name="line299">299: </a>      At[3][3] = {{0,0,0},
<a name="line300">300: </a>                  {1-1/1.414213562373095048802,1-1/1.414213562373095048802,0},
<a name="line301">301: </a>                  {1/(2*1.414213562373095048802),1/(2*1.414213562373095048802),1-1/1.414213562373095048802}},
<a name="line302">302: </a>      bembedt[3] = {(4.-1.414213562373095048802)/8.,(4.-1.414213562373095048802)/8.,1/(2.*1.414213562373095048802)},
<a name="line303">303: </a>      binterpt[3][2] =  {{1.0/1.414213562373095048802,-1.0/(2.0*1.414213562373095048802)},
<a name="line304">304: </a>                         {1.0/1.414213562373095048802,-1.0/(2.0*1.414213562373095048802)},
<a name="line305">305: </a>                         {1.0-1.414213562373095048802,1.0/1.414213562373095048802}};
<a name="line306">306: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEX2D.html#TSARKIMEX2D">TSARKIMEX2D</a>,2,3,&amp;At[0][0],NULL,NULL,&amp;A[0][0],NULL,NULL,bembedt,bembedt,2,binterpt[0],NULL);
<a name="line307">307: </a>  }
<a name="line308">308: </a>  {                             <font color="#B22222">/* Optimal for linear implicit part */</font>
<a name="line309">309: </a>    <font color="#B22222">/* const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> s2 = PetscSqrtReal((<a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>)2.0),  Direct evaluation: 1.414213562373095048802. Used below to ensure all values are available at compile time   */</font>
<a name="line310">310: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line311">311: </a>      A[3][3] = {{0,0,0},
<a name="line312">312: </a>                 {2-1.414213562373095048802,0,0},
<a name="line313">313: </a>                 {(3-2*1.414213562373095048802)/6,(3+2*1.414213562373095048802)/6,0}},
<a name="line314">314: </a>      At[3][3] = {{0,0,0},
<a name="line315">315: </a>                  {1-1/1.414213562373095048802,1-1/1.414213562373095048802,0},
<a name="line316">316: </a>                  {1/(2*1.414213562373095048802),1/(2*1.414213562373095048802),1-1/1.414213562373095048802}},
<a name="line317">317: </a>      bembedt[3] = {(4.-1.414213562373095048802)/8.,(4.-1.414213562373095048802)/8.,1/(2.*1.414213562373095048802)},
<a name="line318">318: </a>      binterpt[3][2] =  {{1.0/1.414213562373095048802,-1.0/(2.0*1.414213562373095048802)},
<a name="line319">319: </a>                         {1.0/1.414213562373095048802,-1.0/(2.0*1.414213562373095048802)},
<a name="line320">320: </a>                         {1.0-1.414213562373095048802,1.0/1.414213562373095048802}};
<a name="line321">321: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEX2E.html#TSARKIMEX2E">TSARKIMEX2E</a>,2,3,&amp;At[0][0],NULL,NULL,&amp;A[0][0],NULL,NULL,bembedt,bembedt,2,binterpt[0],NULL);
<a name="line322">322: </a>  }
<a name="line323">323: </a>  {                             <font color="#B22222">/* Optimal for linear implicit part */</font>
<a name="line324">324: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line325">325: </a>      A[3][3] = {{0,0,0},
<a name="line326">326: </a>                 {0.5,0,0},
<a name="line327">327: </a>                 {0.5,0.5,0}},
<a name="line328">328: </a>      At[3][3] = {{0.25,0,0},
<a name="line329">329: </a>                  {0,0.25,0},
<a name="line330">330: </a>                  {1./3,1./3,1./3}};
<a name="line331">331: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEXPRSSP2.html#TSARKIMEXPRSSP2">TSARKIMEXPRSSP2</a>,2,3,&amp;At[0][0],NULL,NULL,&amp;A[0][0],NULL,NULL,NULL,NULL,0,NULL,NULL);
<a name="line332">332: </a>  }
<a name="line333">333: </a>  {
<a name="line334">334: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line335">335: </a>      A[4][4] = {{0,0,0,0},
<a name="line336">336: </a>                 {1767732205903./2027836641118.,0,0,0},
<a name="line337">337: </a>                 {5535828885825./10492691773637.,788022342437./10882634858940.,0,0},
<a name="line338">338: </a>                 {6485989280629./16251701735622.,-4246266847089./9704473918619.,10755448449292./10357097424841.,0}},
<a name="line339">339: </a>      At[4][4] = {{0,0,0,0},
<a name="line340">340: </a>                  {1767732205903./4055673282236.,1767732205903./4055673282236.,0,0},
<a name="line341">341: </a>                  {2746238789719./10658868560708.,-640167445237./6845629431997.,1767732205903./4055673282236.,0},
<a name="line342">342: </a>                  {1471266399579./7840856788654.,-4482444167858./7529755066697.,11266239266428./11593286722821.,1767732205903./4055673282236.}},
<a name="line343">343: </a>      bembedt[4]     = {2756255671327./12835298489170.,-10771552573575./22201958757719.,9247589265047./10645013368117.,2193209047091./5459859503100.},
<a name="line344">344: </a>      binterpt[4][2] = {{4655552711362./22874653954995., -215264564351./13552729205753.},
<a name="line345">345: </a>                        {-18682724506714./9892148508045.,17870216137069./13817060693119.},
<a name="line346">346: </a>                        {34259539580243./13192909600954.,-28141676662227./17317692491321.},
<a name="line347">347: </a>                        {584795268549./6622622206610.,   2508943948391./7218656332882.}};
<a name="line348">348: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEX3.html#TSARKIMEX3">TSARKIMEX3</a>,3,4,&amp;At[0][0],NULL,NULL,&amp;A[0][0],NULL,NULL,bembedt,bembedt,2,binterpt[0],NULL);
<a name="line349">349: </a>  }
<a name="line350">350: </a>  {
<a name="line351">351: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line352">352: </a>      A[5][5] = {{0,0,0,0,0},
<a name="line353">353: </a>                 {1./2,0,0,0,0},
<a name="line354">354: </a>                 {11./18,1./18,0,0,0},
<a name="line355">355: </a>                 {5./6,-5./6,.5,0,0},
<a name="line356">356: </a>                 {1./4,7./4,3./4,-7./4,0}},
<a name="line357">357: </a>      At[5][5] = {{0,0,0,0,0},
<a name="line358">358: </a>                  {0,1./2,0,0,0},
<a name="line359">359: </a>                  {0,1./6,1./2,0,0},
<a name="line360">360: </a>                  {0,-1./2,1./2,1./2,0},
<a name="line361">361: </a>                  {0,3./2,-3./2,1./2,1./2}},
<a name="line362">362: </a>    *bembedt = NULL;
<a name="line363">363: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEXARS443.html#TSARKIMEXARS443">TSARKIMEXARS443</a>,3,5,&amp;At[0][0],NULL,NULL,&amp;A[0][0],NULL,NULL,bembedt,bembedt,0,NULL,NULL);
<a name="line364">364: </a>  }
<a name="line365">365: </a>  {
<a name="line366">366: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line367">367: </a>      A[5][5] = {{0,0,0,0,0},
<a name="line368">368: </a>                 {1,0,0,0,0},
<a name="line369">369: </a>                 {4./9,2./9,0,0,0},
<a name="line370">370: </a>                 {1./4,0,3./4,0,0},
<a name="line371">371: </a>                 {1./4,0,3./5,0,0}},
<a name="line372">372: </a>      At[5][5] = {{0,0,0,0,0},
<a name="line373">373: </a>                  {.5,.5,0,0,0},
<a name="line374">374: </a>                  {5./18,-1./9,.5,0,0},
<a name="line375">375: </a>                  {.5,0,0,.5,0},
<a name="line376">376: </a>                  {.25,0,.75,-.5,.5}},
<a name="line377">377: </a>    *bembedt = NULL;
<a name="line378">378: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEXBPR3.html#TSARKIMEXBPR3">TSARKIMEXBPR3</a>,3,5,&amp;At[0][0],NULL,NULL,&amp;A[0][0],NULL,NULL,bembedt,bembedt,0,NULL,NULL);
<a name="line379">379: </a>  }
<a name="line380">380: </a>  {
<a name="line381">381: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line382">382: </a>      A[6][6] = {{0,0,0,0,0,0},
<a name="line383">383: </a>                 {1./2,0,0,0,0,0},
<a name="line384">384: </a>                 {13861./62500.,6889./62500.,0,0,0,0},
<a name="line385">385: </a>                 {-116923316275./2393684061468.,-2731218467317./15368042101831.,9408046702089./11113171139209.,0,0,0},
<a name="line386">386: </a>                 {-451086348788./2902428689909.,-2682348792572./7519795681897.,12662868775082./11960479115383.,3355817975965./11060851509271.,0,0},
<a name="line387">387: </a>                 {647845179188./3216320057751.,73281519250./8382639484533.,552539513391./3454668386233.,3354512671639./8306763924573.,4040./17871.,0}},
<a name="line388">388: </a>      At[6][6] = {{0,0,0,0,0,0},
<a name="line389">389: </a>                  {1./4,1./4,0,0,0,0},
<a name="line390">390: </a>                  {8611./62500.,-1743./31250.,1./4,0,0,0},
<a name="line391">391: </a>                  {5012029./34652500.,-654441./2922500.,174375./388108.,1./4,0,0},
<a name="line392">392: </a>                  {15267082809./155376265600.,-71443401./120774400.,730878875./902184768.,2285395./8070912.,1./4,0},
<a name="line393">393: </a>                  {82889./524892.,0,15625./83664.,69875./102672.,-2260./8211,1./4}},
<a name="line394">394: </a>      bembedt[6]     = {4586570599./29645900160.,0,178811875./945068544.,814220225./1159782912.,-3700637./11593932.,61727./225920.},
<a name="line395">395: </a>      binterpt[6][3] = {{6943876665148./7220017795957.,-54480133./30881146.,6818779379841./7100303317025.},
<a name="line396">396: </a>                        {0,0,0},
<a name="line397">397: </a>                        {7640104374378./9702883013639.,-11436875./14766696.,2173542590792./12501825683035.},
<a name="line398">398: </a>                        {-20649996744609./7521556579894.,174696575./18121608.,-31592104683404./5083833661969.},
<a name="line399">399: </a>                        {8854892464581./2390941311638.,-12120380./966161.,61146701046299./7138195549469.},
<a name="line400">400: </a>                        {-11397109935349./6675773540249.,3843./706.,-17219254887155./4939391667607.}};
<a name="line401">401: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEX4.html#TSARKIMEX4">TSARKIMEX4</a>,4,6,&amp;At[0][0],NULL,NULL,&amp;A[0][0],NULL,NULL,bembedt,bembedt,3,binterpt[0],NULL);
<a name="line402">402: </a>  }
<a name="line403">403: </a>  {
<a name="line404">404: </a>    const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>
<a name="line405">405: </a>      A[8][8] = {{0,0,0,0,0,0,0,0},
<a name="line406">406: </a>                 {41./100,0,0,0,0,0,0,0},
<a name="line407">407: </a>                 {367902744464./2072280473677.,677623207551./8224143866563.,0,0,0,0,0,0},
<a name="line408">408: </a>                 {1268023523408./10340822734521.,0,1029933939417./13636558850479.,0,0,0,0,0},
<a name="line409">409: </a>                 {14463281900351./6315353703477.,0,66114435211212./5879490589093.,-54053170152839./4284798021562.,0,0,0,0},
<a name="line410">410: </a>                 {14090043504691./34967701212078.,0,15191511035443./11219624916014.,-18461159152457./12425892160975.,-281667163811./9011619295870.,0,0,0},
<a name="line411">411: </a>                 {19230459214898./13134317526959.,0,21275331358303./2942455364971.,-38145345988419./4862620318723.,-1./8,-1./8,0,0},
<a name="line412">412: </a>                 {-19977161125411./11928030595625.,0,-40795976796054./6384907823539.,177454434618887./12078138498510.,782672205425./8267701900261.,-69563011059811./9646580694205.,7356628210526./4942186776405.,0}},
<a name="line413">413: </a>      At[8][8] = {{0,0,0,0,0,0,0,0},
<a name="line414">414: </a>                  {41./200.,41./200.,0,0,0,0,0,0},
<a name="line415">415: </a>                  {41./400.,-567603406766./11931857230679.,41./200.,0,0,0,0,0},
<a name="line416">416: </a>                  {683785636431./9252920307686.,0,-110385047103./1367015193373.,41./200.,0,0,0,0},
<a name="line417">417: </a>                  {3016520224154./10081342136671.,0,30586259806659./12414158314087.,-22760509404356./11113319521817.,41./200.,0,0,0},
<a name="line418">418: </a>                  {218866479029./1489978393911.,0,638256894668./5436446318841.,-1179710474555./5321154724896.,-60928119172./8023461067671.,41./200.,0,0},
<a name="line419">419: </a>                  {1020004230633./5715676835656.,0,25762820946817./25263940353407.,-2161375909145./9755907335909.,-211217309593./5846859502534.,-4269925059573./7827059040749.,41./200,0},
<a name="line420">420: </a>                  {-872700587467./9133579230613.,0,0,22348218063261./9555858737531.,-1143369518992./8141816002931.,-39379526789629./19018526304540.,32727382324388./42900044865799.,41./200.}},
<a name="line421">421: </a>      bembedt[8]     = {-975461918565./9796059967033.,0,0,78070527104295./32432590147079.,-548382580838./3424219808633.,-33438840321285./15594753105479.,3629800801594./4656183773603.,4035322873751./18575991585200.},
<a name="line422">422: </a>      binterpt[8][3] = {{-17674230611817./10670229744614.,  43486358583215./12773830924787., -9257016797708./5021505065439.},
<a name="line423">423: </a>                        {0,  0, 0                            },
<a name="line424">424: </a>                        {0,  0, 0                            },
<a name="line425">425: </a>                        {65168852399939./7868540260826.,  -91478233927265./11067650958493., 26096422576131./11239449250142.},
<a name="line426">426: </a>                        {15494834004392./5936557850923.,  -79368583304911./10890268929626., 92396832856987./20362823103730.},
<a name="line427">427: </a>                        {-99329723586156./26959484932159.,  -12239297817655./9152339842473., 30029262896817./10175596800299.},
<a name="line428">428: </a>                        {-19024464361622./5461577185407.,  115839755401235./10719374521269., -26136350496073./3983972220547.},
<a name="line429">429: </a>                        {-6511271360970./6095937251113.,  5843115559534./2180450260947., -5289405421727./3760307252460. }};
<a name="line430">430: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEX5.html#TSARKIMEX5">TSARKIMEX5</a>,5,8,&amp;At[0][0],NULL,NULL,&amp;A[0][0],NULL,NULL,bembedt,bembedt,3,binterpt[0],NULL);
<a name="line431">431: </a>  }
<a name="line432">432: </a>  <font color="#4169E1">return</font>(0);
<a name="line433">433: </a>}

<a name="line437">437: </a><font color="#B22222">/*@C</font>
<a name="line438">438: </a><font color="#B22222">   <a href="../../../../docs/manualpages/TS/TSARKIMEXRegisterDestroy.html#TSARKIMEXRegisterDestroy">TSARKIMEXRegisterDestroy</a> - Frees the list of schemes that were registered by <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>().</font>

<a name="line440">440: </a><font color="#B22222">   Not Collective</font>

<a name="line442">442: </a><font color="#B22222">   Level: advanced</font>

<a name="line444">444: </a><font color="#B22222">.keywords: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a>, register, destroy</font>
<a name="line445">445: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(), <a href="../../../../docs/manualpages/TS/TSARKIMEXRegisterAll.html#TSARKIMEXRegisterAll">TSARKIMEXRegisterAll</a>()</font>
<a name="line446">446: </a><font color="#B22222">@*/</font>
<a name="line447">447: </a><strong><font color="#4169E1"><a name="TSARKIMEXRegisterDestroy"></a><a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../docs/manualpages/TS/TSARKIMEXRegisterDestroy.html#TSARKIMEXRegisterDestroy">TSARKIMEXRegisterDestroy</a>(void)</font></strong>
<a name="line448">448: </a>{
<a name="line450">450: </a>  ARKTableauLink link;

<a name="line453">453: </a>  <font color="#4169E1">while</font> ((link = ARKTableauList)) {
<a name="line454">454: </a>    ARKTableau t = &amp;link-&gt;tab;
<a name="line455">455: </a>    ARKTableauList = link-&gt;next;
<a name="line456">456: </a>    <a href="../../../../docs/manualpages/Sys/PetscFree6.html#PetscFree6">PetscFree6</a>(t-&gt;At,t-&gt;bt,t-&gt;ct,t-&gt;A,t-&gt;b,t-&gt;c);
<a name="line457">457: </a>    <a href="../../../../docs/manualpages/Sys/PetscFree2.html#PetscFree2">PetscFree2</a>(t-&gt;bembedt,t-&gt;bembed);
<a name="line458">458: </a>    <a href="../../../../docs/manualpages/Sys/PetscFree2.html#PetscFree2">PetscFree2</a>(t-&gt;binterpt,t-&gt;binterp);
<a name="line459">459: </a>    <a href="../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(t-&gt;name);
<a name="line460">460: </a>    <a href="../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(link);
<a name="line461">461: </a>  }
<a name="line462">462: </a>  TSARKIMEXRegisterAllCalled = <a href="../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line463">463: </a>  <font color="#4169E1">return</font>(0);
<a name="line464">464: </a>}

<a name="line468">468: </a><font color="#B22222">/*@C</font>
<a name="line469">469: </a><font color="#B22222">  <a href="../../../../docs/manualpages/TS/TSARKIMEXInitializePackage.html#TSARKIMEXInitializePackage">TSARKIMEXInitializePackage</a> - This function initializes everything in the <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a> package. It is called</font>
<a name="line470">470: </a><font color="#B22222">  from PetscDLLibraryRegister() when using dynamic libraries, and on the first call to TSCreate_ARKIMEX()</font>
<a name="line471">471: </a><font color="#B22222">  when using static libraries.</font>

<a name="line473">473: </a><font color="#B22222">  Level: developer</font>

<a name="line475">475: </a><font color="#B22222">.keywords: <a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a>, initialize, package</font>
<a name="line476">476: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/Sys/PetscInitialize.html#PetscInitialize">PetscInitialize</a>()</font>
<a name="line477">477: </a><font color="#B22222">@*/</font>
<a name="line478">478: </a><strong><font color="#4169E1"><a name="TSARKIMEXInitializePackage"></a><a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../docs/manualpages/TS/TSARKIMEXInitializePackage.html#TSARKIMEXInitializePackage">TSARKIMEXInitializePackage</a>(void)</font></strong>
<a name="line479">479: </a>{

<a name="line483">483: </a>  <font color="#4169E1">if</font> (TSARKIMEXPackageInitialized) <font color="#4169E1">return</font>(0);
<a name="line484">484: </a>  TSARKIMEXPackageInitialized = <a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line485">485: </a>  <a href="../../../../docs/manualpages/TS/TSARKIMEXRegisterAll.html#TSARKIMEXRegisterAll">TSARKIMEXRegisterAll</a>();
<a name="line486">486: </a>  <a href="../../../../docs/manualpages/Sys/PetscObjectComposedDataRegister.html#PetscObjectComposedDataRegister">PetscObjectComposedDataRegister</a>(&amp;explicit_stage_time_id);
<a name="line487">487: </a>  <a href="../../../../docs/manualpages/Sys/PetscRegisterFinalize.html#PetscRegisterFinalize">PetscRegisterFinalize</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEXFinalizePackage.html#TSARKIMEXFinalizePackage">TSARKIMEXFinalizePackage</a>);
<a name="line488">488: </a>  <font color="#4169E1">return</font>(0);
<a name="line489">489: </a>}

<a name="line493">493: </a><font color="#B22222">/*@C</font>
<a name="line494">494: </a><font color="#B22222">  <a href="../../../../docs/manualpages/TS/TSARKIMEXFinalizePackage.html#TSARKIMEXFinalizePackage">TSARKIMEXFinalizePackage</a> - This function destroys everything in the <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a> package. It is</font>
<a name="line495">495: </a><font color="#B22222">  called from <a href="../../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>().</font>

<a name="line497">497: </a><font color="#B22222">  Level: developer</font>

<a name="line499">499: </a><font color="#B22222">.keywords: Petsc, destroy, package</font>
<a name="line500">500: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/Sys/PetscFinalize.html#PetscFinalize">PetscFinalize</a>()</font>
<a name="line501">501: </a><font color="#B22222">@*/</font>
<a name="line502">502: </a><strong><font color="#4169E1"><a name="TSARKIMEXFinalizePackage"></a><a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../docs/manualpages/TS/TSARKIMEXFinalizePackage.html#TSARKIMEXFinalizePackage">TSARKIMEXFinalizePackage</a>(void)</font></strong>
<a name="line503">503: </a>{

<a name="line507">507: </a>  TSARKIMEXPackageInitialized = <a href="../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line508">508: </a>  <a href="../../../../docs/manualpages/TS/TSARKIMEXRegisterDestroy.html#TSARKIMEXRegisterDestroy">TSARKIMEXRegisterDestroy</a>();
<a name="line509">509: </a>  <font color="#4169E1">return</font>(0);
<a name="line510">510: </a>}

<a name="line514">514: </a><font color="#B22222">/*@C</font>
<a name="line515">515: </a><font color="#B22222">   <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a> - register an ARK IMEX scheme by providing the entries in the Butcher tableau and optionally embedded approximations and interpolation</font>

<a name="line517">517: </a><font color="#B22222">   Not Collective, but the same schemes should be registered on all processes on which they will be used</font>

<a name="line519">519: </a><font color="#B22222">   Input Parameters:</font>
<a name="line520">520: </a><font color="#B22222">+  name - identifier for method</font>
<a name="line521">521: </a><font color="#B22222">.  order - approximation order of method</font>
<a name="line522">522: </a><font color="#B22222">.  s - number of stages, this is the dimension of the matrices below</font>
<a name="line523">523: </a><font color="#B22222">.  At - Butcher table of stage coefficients for stiff part (dimension s*s, row-major)</font>
<a name="line524">524: </a><font color="#B22222">.  bt - Butcher table for completing the stiff part of the step (dimension s; NULL to use the last row of At)</font>
<a name="line525">525: </a><font color="#B22222">.  ct - Abscissa of each stiff stage (dimension s, NULL to use row sums of At)</font>
<a name="line526">526: </a><font color="#B22222">.  A - Non-stiff stage coefficients (dimension s*s, row-major)</font>
<a name="line527">527: </a><font color="#B22222">.  b - Non-stiff step completion table (dimension s; NULL to use last row of At)</font>
<a name="line528">528: </a><font color="#B22222">.  c - Non-stiff abscissa (dimension s; NULL to use row sums of A)</font>
<a name="line529">529: </a><font color="#B22222">.  bembedt - Stiff part of completion table for embedded method (dimension s; NULL if not available)</font>
<a name="line530">530: </a><font color="#B22222">.  bembed - Non-stiff part of completion table for embedded method (dimension s; NULL to use bembedt if provided)</font>
<a name="line531">531: </a><font color="#B22222">.  pinterp - Order of the interpolation scheme, equal to the number of columns of binterpt and binterp</font>
<a name="line532">532: </a><font color="#B22222">.  binterpt - Coefficients of the interpolation formula for the stiff part (dimension s*pinterp)</font>
<a name="line533">533: </a><font color="#B22222">-  binterp - Coefficients of the interpolation formula for the non-stiff part (dimension s*pinterp; NULL to reuse binterpt)</font>

<a name="line535">535: </a><font color="#B22222">   Notes:</font>
<a name="line536">536: </a><font color="#B22222">   Several ARK IMEX methods are provided, this function is only needed to create new methods.</font>

<a name="line538">538: </a><font color="#B22222">   Level: advanced</font>

<a name="line540">540: </a><font color="#B22222">.keywords: <a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>, register</font>

<a name="line542">542: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a></font>
<a name="line543">543: </a><font color="#B22222">@*/</font>
<a name="line544">544: </a><strong><font color="#4169E1"><a name="TSARKIMEXRegister"></a><a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>(<a href="../../../../docs/manualpages/TS/TSARKIMEXType.html#TSARKIMEXType">TSARKIMEXType</a> name,<a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> order,<a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> s,</font></strong>
<a name="line545">545: </a><strong><font color="#4169E1">                                 const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> At[],const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> bt[],const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> ct[],</font></strong>
<a name="line546">546: </a><strong><font color="#4169E1">                                 const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> A[],const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> b[],const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> c[],</font></strong>
<a name="line547">547: </a><strong><font color="#4169E1">                                 const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> bembedt[],const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> bembed[],</font></strong>
<a name="line548">548: </a><strong><font color="#4169E1">                                 <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> pinterp,const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> binterpt[],const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> binterp[])</font></strong>
<a name="line549">549: </a>{
<a name="line551">551: </a>  ARKTableauLink link;
<a name="line552">552: </a>  ARKTableau     t;
<a name="line553">553: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       i,j;

<a name="line556">556: </a>  <a href="../../../../docs/manualpages/Sys/PetscCalloc1.html#PetscCalloc1">PetscCalloc1</a>(1,&amp;link);
<a name="line557">557: </a>  t        = &amp;link-&gt;tab;
<a name="line558">558: </a>  <a href="../../../../docs/manualpages/Sys/PetscStrallocpy.html#PetscStrallocpy">PetscStrallocpy</a>(name,&amp;t-&gt;name);
<a name="line559">559: </a>  t-&gt;order = order;
<a name="line560">560: </a>  t-&gt;s     = s;
<a name="line561">561: </a>  <a href="../../../../docs/manualpages/Sys/PetscMalloc6.html#PetscMalloc6">PetscMalloc6</a>(s*s,&amp;t-&gt;At,s,&amp;t-&gt;bt,s,&amp;t-&gt;ct,s*s,&amp;t-&gt;A,s,&amp;t-&gt;b,s,&amp;t-&gt;c);
<a name="line562">562: </a>  <a href="../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(t-&gt;At,At,s*s*<font color="#4169E1">sizeof</font>(At[0]));
<a name="line563">563: </a>  <a href="../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(t-&gt;A,A,s*s*<font color="#4169E1">sizeof</font>(A[0]));
<a name="line564">564: </a>  <font color="#4169E1">if</font> (bt) { <a href="../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(t-&gt;bt,bt,s*<font color="#4169E1">sizeof</font>(bt[0])); }
<a name="line565">565: </a>  <font color="#4169E1">else</font> <font color="#4169E1">for</font> (i=0; i&lt;s; i++) t-&gt;bt[i] = At[(s-1)*s+i];
<a name="line566">566: </a>  <font color="#4169E1">if</font> (b)  { <a href="../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(t-&gt;b,b,s*<font color="#4169E1">sizeof</font>(b[0])); }
<a name="line567">567: </a>  <font color="#4169E1">else</font> <font color="#4169E1">for</font> (i=0; i&lt;s; i++) t-&gt;b[i] = t-&gt;bt[i];
<a name="line568">568: </a>  <font color="#4169E1">if</font> (ct) { <a href="../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(t-&gt;ct,ct,s*<font color="#4169E1">sizeof</font>(ct[0])); }
<a name="line569">569: </a>  <font color="#4169E1">else</font> <font color="#4169E1">for</font> (i=0; i&lt;s; i++) <font color="#4169E1">for</font> (j=0,t-&gt;ct[i]=0; j&lt;s; j++) t-&gt;ct[i] += At[i*s+j];
<a name="line570">570: </a>  <font color="#4169E1">if</font> (c)  { <a href="../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(t-&gt;c,c,s*<font color="#4169E1">sizeof</font>(c[0])); }
<a name="line571">571: </a>  <font color="#4169E1">else</font> <font color="#4169E1">for</font> (i=0; i&lt;s; i++) <font color="#4169E1">for</font> (j=0,t-&gt;c[i]=0; j&lt;s; j++) t-&gt;c[i] += A[i*s+j];
<a name="line572">572: </a>  t-&gt;stiffly_accurate = <a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line573">573: </a>  <font color="#4169E1">for</font> (i=0; i&lt;s; i++) <font color="#4169E1">if</font> (t-&gt;At[(s-1)*s+i] != t-&gt;bt[i]) t-&gt;stiffly_accurate = <a href="../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line574">574: </a>  t-&gt;explicit_first_stage = <a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line575">575: </a>  <font color="#4169E1">for</font> (i=0; i&lt;s; i++) <font color="#4169E1">if</font> (t-&gt;At[i] != 0.0) t-&gt;explicit_first_stage = <a href="../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line576">576: </a>  <font color="#B22222">/*def of FSAL can be made more precise*/</font>
<a name="line577">577: </a>  t-&gt;FSAL_implicit = (<a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>)(t-&gt;explicit_first_stage &amp;&amp; t-&gt;stiffly_accurate);
<a name="line578">578: </a>  <font color="#4169E1">if</font> (bembedt) {
<a name="line579">579: </a>    <a href="../../../../docs/manualpages/Sys/PetscMalloc2.html#PetscMalloc2">PetscMalloc2</a>(s,&amp;t-&gt;bembedt,s,&amp;t-&gt;bembed);
<a name="line580">580: </a>    <a href="../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(t-&gt;bembedt,bembedt,s*<font color="#4169E1">sizeof</font>(bembedt[0]));
<a name="line581">581: </a>    <a href="../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(t-&gt;bembed,bembed ? bembed : bembedt,s*<font color="#4169E1">sizeof</font>(bembed[0]));
<a name="line582">582: </a>  }

<a name="line584">584: </a>  t-&gt;pinterp     = pinterp;
<a name="line585">585: </a>  <a href="../../../../docs/manualpages/Sys/PetscMalloc2.html#PetscMalloc2">PetscMalloc2</a>(s*pinterp,&amp;t-&gt;binterpt,s*pinterp,&amp;t-&gt;binterp);
<a name="line586">586: </a>  <a href="../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(t-&gt;binterpt,binterpt,s*pinterp*<font color="#4169E1">sizeof</font>(binterpt[0]));
<a name="line587">587: </a>  <a href="../../../../docs/manualpages/Sys/PetscMemcpy.html#PetscMemcpy">PetscMemcpy</a>(t-&gt;binterp,binterp ? binterp : binterpt,s*pinterp*<font color="#4169E1">sizeof</font>(binterpt[0]));
<a name="line588">588: </a>  link-&gt;next     = ARKTableauList;
<a name="line589">589: </a>  ARKTableauList = link;
<a name="line590">590: </a>  <font color="#4169E1">return</font>(0);
<a name="line591">591: </a>}

<a name="line595">595: </a><font color="#B22222">/*</font>
<a name="line596">596: </a><font color="#B22222"> The step completion formula is</font>

<a name="line598">598: </a><font color="#B22222"> x1 = x0 - h bt^T YdotI + h b^T YdotRHS</font>

<a name="line600">600: </a><font color="#B22222"> This function can be called before or after ts-&gt;vec_sol has been updated.</font>
<a name="line601">601: </a><font color="#B22222"> Suppose we have a completion formula (bt,b) and an embedded formula (bet,be) of different order.</font>
<a name="line602">602: </a><font color="#B22222"> We can write</font>

<a name="line604">604: </a><font color="#B22222"> x1e = x0 - h bet^T YdotI + h be^T YdotRHS</font>
<a name="line605">605: </a><font color="#B22222">     = x1 + h bt^T YdotI - h b^T YdotRHS - h bet^T YdotI + h be^T YdotRHS</font>
<a name="line606">606: </a><font color="#B22222">     = x1 - h (bet - bt)^T YdotI + h (be - b)^T YdotRHS</font>

<a name="line608">608: </a><font color="#B22222"> so we can evaluate the method with different order even after the step has been optimistically completed.</font>
<a name="line609">609: </a><font color="#B22222">*/</font>
<a name="line610">610: </a><strong><font color="#4169E1"><a name="TSEvaluateStep_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSEvaluateStep_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> order,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> X,<a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> *done)</font></strong>
<a name="line611">611: </a>{
<a name="line612">612: </a>  TS_ARKIMEX     *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line613">613: </a>  ARKTableau     tab  = ark-&gt;tableau;
<a name="line614">614: </a>  <a href="../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a>    *w   = ark-&gt;work;
<a name="line615">615: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>      h;
<a name="line616">616: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       s = tab-&gt;s,j;

<a name="line620">620: </a>  <font color="#4169E1">switch</font> (ark-&gt;status) {
<a name="line621">621: </a>  <font color="#4169E1">case</font> TS_STEP_INCOMPLETE:
<a name="line622">622: </a>  <font color="#4169E1">case</font> TS_STEP_PENDING:
<a name="line623">623: </a>    h = ts-&gt;time_step; <font color="#4169E1">break</font>;
<a name="line624">624: </a>  <font color="#4169E1">case</font> TS_STEP_COMPLETE:
<a name="line625">625: </a>    h = ts-&gt;time_step_prev; <font color="#4169E1">break</font>;
<a name="line626">626: </a><strong><font color="#FF0000">  default:</font></strong> <a href="../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts),PETSC_ERR_PLIB,<font color="#666666">"Invalid TSStepStatus"</font>);
<a name="line627">627: </a>  }
<a name="line628">628: </a>  <font color="#4169E1">if</font> (order == tab-&gt;order) {
<a name="line629">629: </a>    <font color="#4169E1">if</font> (ark-&gt;status == TS_STEP_INCOMPLETE) {
<a name="line630">630: </a>      <font color="#4169E1">if</font> (!ark-&gt;imex &amp;&amp; tab-&gt;stiffly_accurate) { <font color="#B22222">/* Only the stiffly accurate implicit formula is used */</font>
<a name="line631">631: </a>        <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(ark-&gt;Y[s-1],X);
<a name="line632">632: </a>      } <font color="#4169E1">else</font> { <font color="#B22222">/* Use the standard completion formula (bt,b) */</font>
<a name="line633">633: </a>        <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(ts-&gt;vec_sol,X);
<a name="line634">634: </a>        <font color="#4169E1">for</font> (j=0; j&lt;s; j++) w[j] = h*tab-&gt;bt[j];
<a name="line635">635: </a>        <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(X,s,w,ark-&gt;YdotI);
<a name="line636">636: </a>        <font color="#4169E1">if</font> (ark-&gt;imex) { <font color="#B22222">/* Method is IMEX, complete the explicit formula */</font>
<a name="line637">637: </a>          <font color="#4169E1">for</font> (j=0; j&lt;s; j++) w[j] = h*tab-&gt;b[j];
<a name="line638">638: </a>          <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(X,s,w,ark-&gt;YdotRHS);
<a name="line639">639: </a>        }
<a name="line640">640: </a>      }
<a name="line641">641: </a>    } <font color="#4169E1">else</font> {<a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(ts-&gt;vec_sol,X);}
<a name="line642">642: </a>    <font color="#4169E1">if</font> (done) *done = <a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line643">643: </a>    <font color="#4169E1">return</font>(0);
<a name="line644">644: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (order == tab-&gt;order-1) {
<a name="line645">645: </a>    <font color="#4169E1">if</font> (!tab-&gt;bembedt) <font color="#4169E1">goto</font> unavailable;
<a name="line646">646: </a>    <font color="#4169E1">if</font> (ark-&gt;status == TS_STEP_INCOMPLETE) { <font color="#B22222">/* Complete with the embedded method (bet,be) */</font>
<a name="line647">647: </a>      <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(ts-&gt;vec_sol,X);
<a name="line648">648: </a>      <font color="#4169E1">for</font> (j=0; j&lt;s; j++) w[j] = h*tab-&gt;bembedt[j];
<a name="line649">649: </a>      <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(X,s,w,ark-&gt;YdotI);
<a name="line650">650: </a>      <font color="#4169E1">for</font> (j=0; j&lt;s; j++) w[j] = h*tab-&gt;bembed[j];
<a name="line651">651: </a>      <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(X,s,w,ark-&gt;YdotRHS);
<a name="line652">652: </a>    } <font color="#4169E1">else</font> {                    <font color="#B22222">/* Rollback and re-complete using (bet-be,be-b) */</font>
<a name="line653">653: </a>      <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(ts-&gt;vec_sol,X);
<a name="line654">654: </a>      <font color="#4169E1">for</font> (j=0; j&lt;s; j++) w[j] = h*(tab-&gt;bembedt[j] - tab-&gt;bt[j]);
<a name="line655">655: </a>      <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(X,tab-&gt;s,w,ark-&gt;YdotI);
<a name="line656">656: </a>      <font color="#4169E1">for</font> (j=0; j&lt;s; j++) w[j] = h*(tab-&gt;bembed[j] - tab-&gt;b[j]);
<a name="line657">657: </a>      <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(X,s,w,ark-&gt;YdotRHS);
<a name="line658">658: </a>    }
<a name="line659">659: </a>    <font color="#4169E1">if</font> (done) *done = <a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line660">660: </a>    <font color="#4169E1">return</font>(0);
<a name="line661">661: </a>  }
<a name="line662">662: </a><strong><font color="#FF0000">unavailable:</font></strong>
<a name="line663">663: </a>  <font color="#4169E1">if</font> (done) *done = <a href="../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line664">664: </a>  <font color="#4169E1">else</font> <a href="../../../../docs/manualpages/Sys/SETERRQ3.html#SETERRQ3">SETERRQ3</a>(<a href="../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts),PETSC_ERR_SUP,<font color="#666666">"ARKIMEX '%s' of order %D cannot evaluate step at order %D. Consider using -ts_adapt_type none or a different method that has an embedded estimate."</font>,tab-&gt;name,tab-&gt;order,order);
<a name="line665">665: </a>  <font color="#4169E1">return</font>(0);
<a name="line666">666: </a>}

<a name="line670">670: </a><strong><font color="#4169E1"><a name="TSRollBack_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSRollBack_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts)</font></strong>
<a name="line671">671: </a>{
<a name="line672">672: </a>  TS_ARKIMEX      *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line673">673: </a>  ARKTableau      tab  = ark-&gt;tableau;
<a name="line674">674: </a>  const <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>  s    = tab-&gt;s;
<a name="line675">675: </a>  const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *bt = tab-&gt;bt,*b = tab-&gt;b;
<a name="line676">676: </a>  <a href="../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a>     *w   = ark-&gt;work;
<a name="line677">677: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>             *YdotI = ark-&gt;YdotI,*YdotRHS = ark-&gt;YdotRHS;
<a name="line678">678: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        j;
<a name="line679">679: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>       h=ts-&gt;time_step;
<a name="line680">680: </a>  <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  ierr;

<a name="line683">683: </a>  <font color="#4169E1">for</font> (j=0; j&lt;s; j++) w[j] = -h*bt[j];
<a name="line684">684: </a>  <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(ts-&gt;vec_sol,s,w,YdotI);
<a name="line685">685: </a>  <font color="#4169E1">for</font> (j=0; j&lt;s; j++) w[j] = -h*b[j];
<a name="line686">686: </a>  <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(ts-&gt;vec_sol,s,w,YdotRHS);
<a name="line687">687: </a>  ark-&gt;status   = TS_STEP_INCOMPLETE;
<a name="line688">688: </a>  <font color="#4169E1">return</font>(0);
<a name="line689">689: </a>}

<a name="line693">693: </a><strong><font color="#4169E1"><a name="TSStep_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSStep_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts)</font></strong>
<a name="line694">694: </a>{
<a name="line695">695: </a>  TS_ARKIMEX      *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line696">696: </a>  ARKTableau      tab  = ark-&gt;tableau;
<a name="line697">697: </a>  const <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>  s    = tab-&gt;s;
<a name="line698">698: </a>  const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *At  = tab-&gt;At,*A = tab-&gt;A,*ct = tab-&gt;ct,*c = tab-&gt;c;
<a name="line699">699: </a>  <a href="../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a>     *w   = ark-&gt;work;
<a name="line700">700: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>             *Y   = ark-&gt;Y,*YdotI = ark-&gt;YdotI,*YdotRHS = ark-&gt;YdotRHS,Ydot = ark-&gt;Ydot,Ydot0 = ark-&gt;Ydot0,Z = ark-&gt;Z;
<a name="line701">701: </a>  <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>       init_guess_extrp = ark-&gt;init_guess_extrp;
<a name="line702">702: </a>  <a href="../../../../docs/manualpages/TS/TSAdapt.html#TSAdapt">TSAdapt</a>         adapt;
<a name="line703">703: </a>  <a href="../../../../docs/manualpages/SNES/SNES.html#SNES">SNES</a>            snes;
<a name="line704">704: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        i,j,its,lits,reject,next_scheme;
<a name="line705">705: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>       t;
<a name="line706">706: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>       next_time_step;
<a name="line707">707: </a>  <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>       accept;
<a name="line708">708: </a>  <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  ierr;

<a name="line711">711: </a>  <font color="#4169E1">if</font> (ts-&gt;equation_type &gt;= TS_EQ_IMPLICIT &amp;&amp; tab-&gt;explicit_first_stage) {
<a name="line712">712: </a>    <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> valid_time;
<a name="line713">713: </a>    <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> isvalid;
<a name="line714">714: </a>    <a href="../../../../docs/manualpages/Sys/PetscObjectComposedDataGetReal.html#PetscObjectComposedDataGetReal">PetscObjectComposedDataGetReal</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts-&gt;vec_sol,explicit_stage_time_id,valid_time,isvalid);
<a name="line715">715: </a>    <font color="#4169E1">if</font> (!isvalid || valid_time != ts-&gt;ptime) {
<a name="line716">716: </a>      <a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>        ts_start;
<a name="line717">717: </a>      <a href="../../../../docs/manualpages/SNES/SNES.html#SNES">SNES</a>      snes_dup=NULL;

<a name="line719">719: </a>      <a href="../../../../docs/manualpages/TS/TSClone.html#TSClone">TSClone</a>(ts,&amp;ts_start);

<a name="line721">721: </a>      <a href="../../../../docs/manualpages/TS/TSSetSolution.html#TSSetSolution">TSSetSolution</a>(ts_start,ts-&gt;vec_sol);
<a name="line722">722: </a>      <a href="../../../../docs/manualpages/TS/TSSetTime.html#TSSetTime">TSSetTime</a>(ts_start,ts-&gt;ptime);
<a name="line723">723: </a>      <a href="../../../../docs/manualpages/TS/TSSetDuration.html#TSSetDuration">TSSetDuration</a>(ts_start,1,ts-&gt;ptime+ts-&gt;time_step);
<a name="line724">724: </a>      <a href="../../../../docs/manualpages/TS/TSSetTimeStep.html#TSSetTimeStep">TSSetTimeStep</a>(ts_start,ts-&gt;time_step);
<a name="line725">725: </a>      <a href="../../../../docs/manualpages/TS/TSSetType.html#TSSetType">TSSetType</a>(ts_start,<a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a>);
<a name="line726">726: </a>      <a href="../../../../docs/manualpages/TS/TSARKIMEXSetFullyImplicit.html#TSARKIMEXSetFullyImplicit">TSARKIMEXSetFullyImplicit</a>(ts_start,<a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>);
<a name="line727">727: </a>      <a href="../../../../docs/manualpages/TS/TSARKIMEXSetType.html#TSARKIMEXSetType">TSARKIMEXSetType</a>(ts_start,<a href="../../../../docs/manualpages/TS/TSARKIMEX1BEE.html#TSARKIMEX1BEE">TSARKIMEX1BEE</a>);

<a name="line729">729: </a>      <a href="../../../../docs/manualpages/TS/TSSolve.html#TSSolve">TSSolve</a>(ts_start,ts-&gt;vec_sol);
<a name="line730">730: </a>      <a href="../../../../docs/manualpages/TS/TSGetTime.html#TSGetTime">TSGetTime</a>(ts_start,&amp;ts-&gt;ptime);

<a name="line732">732: </a>      ts-&gt;time_step = ts_start-&gt;time_step;
<a name="line733">733: </a>      ts-&gt;steps++;
<a name="line734">734: </a>      <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(((TS_ARKIMEX*)ts_start-&gt;data)-&gt;Ydot0,Ydot0);

<a name="line736">736: </a>      <font color="#B22222">/* Set the correct <a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> in <a href="../../../../docs/manualpages/SNES/SNES.html#SNES">SNES</a> */</font>
<a name="line737">737: </a>      <font color="#B22222">/* We'll try to bypass this by changing the method on the fly */</font>
<a name="line738">738: </a>      <a href="../../../../docs/manualpages/TS/TSGetSNES.html#TSGetSNES">TSGetSNES</a>(ts,&amp;snes_dup);
<a name="line739">739: </a>      <a href="../../../../docs/manualpages/TS/TSSetSNES.html#TSSetSNES">TSSetSNES</a>(ts,snes_dup);

<a name="line741">741: </a>      <a href="../../../../docs/manualpages/TS/TSDestroy.html#TSDestroy">TSDestroy</a>(&amp;ts_start);
<a name="line742">742: </a>    }
<a name="line743">743: </a>  }

<a name="line745">745: </a>  <a href="../../../../docs/manualpages/TS/TSGetSNES.html#TSGetSNES">TSGetSNES</a>(ts,&amp;snes);
<a name="line746">746: </a>  t              = ts-&gt;ptime;
<a name="line747">747: </a>  next_time_step = ts-&gt;time_step;
<a name="line748">748: </a>  accept         = <a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line749">749: </a>  ark-&gt;status    = TS_STEP_INCOMPLETE;


<a name="line752">752: </a>  <font color="#4169E1">for</font> (reject=0; reject&lt;ts-&gt;max_reject &amp;&amp; !ts-&gt;reason; reject++,ts-&gt;reject++) {
<a name="line753">753: </a>    <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> h = ts-&gt;time_step;
<a name="line754">754: </a>    <a href="../../../../docs/manualpages/TS/TSPreStep.html#TSPreStep">TSPreStep</a>(ts);
<a name="line755">755: </a>    <font color="#4169E1">for</font> (i=0; i&lt;s; i++) {
<a name="line756">756: </a>      ark-&gt;stage_time = t + h*ct[i];
<a name="line757">757: </a>      <font color="#4169E1">if</font> (At[i*s+i] == 0) {           <font color="#B22222">/* This stage is explicit */</font>
<a name="line758">758: </a>        <font color="#4169E1">if</font>(i!=0 &amp;&amp; ts-&gt;equation_type&gt;=TS_EQ_IMPLICIT){
<a name="line759">759: </a>          <a href="../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts),PETSC_ERR_SUP,<font color="#666666">"Explicit stages other than the first one are not supported for implicit problems"</font>);
<a name="line760">760: </a>        }
<a name="line761">761: </a>        <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(ts-&gt;vec_sol,Y[i]);
<a name="line762">762: </a>        <font color="#4169E1">for</font> (j=0; j&lt;i; j++) w[j] = h*At[i*s+j];
<a name="line763">763: </a>        <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(Y[i],i,w,YdotI);
<a name="line764">764: </a>        <font color="#4169E1">for</font> (j=0; j&lt;i; j++) w[j] = h*A[i*s+j];
<a name="line765">765: </a>        <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(Y[i],i,w,YdotRHS);
<a name="line766">766: </a>      } <font color="#4169E1">else</font> {
<a name="line767">767: </a>        ark-&gt;scoeff     = 1./At[i*s+i];
<a name="line768">768: </a>        <a href="../../../../docs/manualpages/TS/TSPreStage.html#TSPreStage">TSPreStage</a>(ts,ark-&gt;stage_time);

<a name="line770">770: </a>        <font color="#B22222">/* Ydot = shift*(Y-Z) */</font>
<a name="line771">771: </a>        <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(ts-&gt;vec_sol,Z);
<a name="line772">772: </a>        <font color="#4169E1">for</font> (j=0; j&lt;i; j++) w[j] = h*At[i*s+j];
<a name="line773">773: </a>        <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(Z,i,w,YdotI);
<a name="line774">774: </a>        <font color="#4169E1">for</font> (j=0; j&lt;i; j++) w[j] = h*A[i*s+j];
<a name="line775">775: </a>        <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(Z,i,w,YdotRHS);

<a name="line777">777: </a>        <font color="#4169E1">if</font> (init_guess_extrp &amp;&amp; ark-&gt;prev_step_valid) {
<a name="line778">778: </a>          <font color="#B22222">/* Initial guess extrapolated from previous time step stage values */</font>
<a name="line779">779: </a>          TSExtrapolate_ARKIMEX(ts,c[i],Y[i]);
<a name="line780">780: </a>        } <font color="#4169E1">else</font> {
<a name="line781">781: </a>          <font color="#B22222">/* Initial guess taken from last stage */</font>
<a name="line782">782: </a>          <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(i&gt;0 ? Y[i-1] : ts-&gt;vec_sol,Y[i]);
<a name="line783">783: </a>        }
<a name="line784">784: </a>        <a href="../../../../docs/manualpages/SNES/SNESSolve.html#SNESSolve">SNESSolve</a>(snes,NULL,Y[i]);
<a name="line785">785: </a>        <a href="../../../../docs/manualpages/SNES/SNESGetIterationNumber.html#SNESGetIterationNumber">SNESGetIterationNumber</a>(snes,&amp;its);
<a name="line786">786: </a>        <a href="../../../../docs/manualpages/SNES/SNESGetLinearSolveIterations.html#SNESGetLinearSolveIterations">SNESGetLinearSolveIterations</a>(snes,&amp;lits);
<a name="line787">787: </a>        ts-&gt;snes_its += its; ts-&gt;ksp_its += lits;
<a name="line788">788: </a>        <a href="../../../../docs/manualpages/TS/TSGetAdapt.html#TSGetAdapt">TSGetAdapt</a>(ts,&amp;adapt);
<a name="line789">789: </a>        <a href="../../../../docs/manualpages/TS/TSAdaptCheckStage.html#TSAdaptCheckStage">TSAdaptCheckStage</a>(adapt,ts,&amp;accept);
<a name="line790">790: </a>        <font color="#4169E1">if</font> (!accept) {
<a name="line791">791: </a>          <font color="#B22222">/* We are likely rejecting the step because of solver or function domain problems so we should not attempt to</font>
<a name="line792">792: </a><font color="#B22222">           * use extrapolation to initialize the solves on the next attempt. */</font>
<a name="line793">793: </a>          ark-&gt;prev_step_valid = <a href="../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line794">794: </a>          <font color="#4169E1">goto</font> reject_step;
<a name="line795">795: </a>        }
<a name="line796">796: </a>      }
<a name="line797">797: </a>      <a href="../../../../docs/manualpages/TS/TSPostStage.html#TSPostStage">TSPostStage</a>(ts,ark-&gt;stage_time,i,Y);
<a name="line798">798: </a>      <font color="#4169E1">if</font> (ts-&gt;equation_type&gt;=TS_EQ_IMPLICIT) {
<a name="line799">799: </a>        <font color="#4169E1">if</font> (i==0 &amp;&amp; tab-&gt;explicit_first_stage) {
<a name="line800">800: </a>          <font color="#4169E1">if</font>(!tab-&gt;stiffly_accurate ) {
<a name="line801">801: </a>            <a href="../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts),PETSC_ERR_SUP,<font color="#666666">"<a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a> %s is not stiffly accurate and therefore explicit-first stage methods cannot be used if the equation is implicit because the slope cannot be evaluated"</font>,ark-&gt;tableau-&gt;name);
<a name="line802">802: </a>          }
<a name="line803">803: </a>          <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(Ydot0,YdotI[0]);                                      <font color="#B22222">/* YdotI = YdotI(tn-1) */</font>
<a name="line804">804: </a>        } <font color="#4169E1">else</font> {
<a name="line805">805: </a>          <a href="../../../../docs/manualpages/Vec/VecAXPBYPCZ.html#VecAXPBYPCZ">VecAXPBYPCZ</a>(YdotI[i],-ark-&gt;scoeff/h,ark-&gt;scoeff/h,0,Z,Y[i]);  <font color="#B22222">/* YdotI = shift*(X-Z) */</font>
<a name="line806">806: </a>        }
<a name="line807">807: </a>      } <font color="#4169E1">else</font> {
<a name="line808">808: </a>        <font color="#4169E1">if</font> (i==0 &amp;&amp; tab-&gt;explicit_first_stage) {
<a name="line809">809: </a>          <a href="../../../../docs/manualpages/Vec/VecZeroEntries.html#VecZeroEntries">VecZeroEntries</a>(Ydot);
<a name="line810">810: </a>          <a href="../../../../docs/manualpages/TS/TSComputeIFunction.html#TSComputeIFunction">TSComputeIFunction</a>(ts,t+h*ct[i],Y[i],Ydot,YdotI[i],ark-&gt;imex);<font color="#B22222">/* YdotI = -G(t,Y,0)   */</font>
<a name="line811">811: </a>          <a href="../../../../docs/manualpages/Vec/VecScale.html#VecScale">VecScale</a>(YdotI[i], -1.0);
<a name="line812">812: </a>        } <font color="#4169E1">else</font> {
<a name="line813">813: </a>          <a href="../../../../docs/manualpages/Vec/VecAXPBYPCZ.html#VecAXPBYPCZ">VecAXPBYPCZ</a>(YdotI[i],-ark-&gt;scoeff/h,ark-&gt;scoeff/h,0,Z,Y[i]);  <font color="#B22222">/* YdotI = shift*(X-Z) */</font>
<a name="line814">814: </a>        }
<a name="line815">815: </a>        <font color="#4169E1">if</font> (ark-&gt;imex) {
<a name="line816">816: </a>          <a href="../../../../docs/manualpages/TS/TSComputeRHSFunction.html#TSComputeRHSFunction">TSComputeRHSFunction</a>(ts,t+h*c[i],Y[i],YdotRHS[i]);
<a name="line817">817: </a>        } <font color="#4169E1">else</font> {
<a name="line818">818: </a>          <a href="../../../../docs/manualpages/Vec/VecZeroEntries.html#VecZeroEntries">VecZeroEntries</a>(YdotRHS[i]);
<a name="line819">819: </a>        }
<a name="line820">820: </a>      }
<a name="line821">821: </a>    }
<a name="line822">822: </a>    <a href="../../../../docs/manualpages/TS/TSEvaluateStep.html#TSEvaluateStep">TSEvaluateStep</a>(ts,tab-&gt;order,ts-&gt;vec_sol,NULL);
<a name="line823">823: </a>    ark-&gt;status = TS_STEP_PENDING;

<a name="line825">825: </a>    <font color="#B22222">/* Register only the current method as a candidate because we're not supporting multiple candidates yet. */</font>
<a name="line826">826: </a>    <a href="../../../../docs/manualpages/TS/TSGetAdapt.html#TSGetAdapt">TSGetAdapt</a>(ts,&amp;adapt);
<a name="line827">827: </a>    <a href="../../../../docs/manualpages/TS/TSAdaptCandidatesClear.html#TSAdaptCandidatesClear">TSAdaptCandidatesClear</a>(adapt);
<a name="line828">828: </a>    <a href="../../../../docs/manualpages/TS/TSAdaptCandidateAdd.html#TSAdaptCandidateAdd">TSAdaptCandidateAdd</a>(adapt,tab-&gt;name,tab-&gt;order,1,tab-&gt;ccfl,1.*tab-&gt;s,<a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>);
<a name="line829">829: </a>    <a href="../../../../docs/manualpages/TS/TSAdaptChoose.html#TSAdaptChoose">TSAdaptChoose</a>(adapt,ts,ts-&gt;time_step,&amp;next_scheme,&amp;next_time_step,&amp;accept);
<a name="line830">830: </a>    <font color="#4169E1">if</font> (accept) {
<a name="line831">831: </a>      <font color="#B22222">/* ignore next_scheme for now */</font>
<a name="line832">832: </a>      ts-&gt;ptime    += ts-&gt;time_step;
<a name="line833">833: </a>      ts-&gt;time_step = next_time_step;
<a name="line834">834: </a>      ts-&gt;steps++;
<a name="line835">835: </a>      <font color="#4169E1">if</font> (ts-&gt;equation_type&gt;=TS_EQ_IMPLICIT) { <font color="#B22222">/* save the initial slope for the next step*/</font>
<a name="line836">836: </a>        <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(YdotI[s-1],Ydot0);
<a name="line837">837: </a>      }
<a name="line838">838: </a>      ark-&gt;status = TS_STEP_COMPLETE;
<a name="line839">839: </a>      <font color="#4169E1">if</font> (tab-&gt;explicit_first_stage) {
<a name="line840">840: </a>        <a href="../../../../docs/manualpages/Sys/PetscObjectComposedDataSetReal.html#PetscObjectComposedDataSetReal">PetscObjectComposedDataSetReal</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts-&gt;vec_sol,explicit_stage_time_id,ts-&gt;ptime);
<a name="line841">841: </a>      }
<a name="line842">842: </a>      <font color="#B22222">/* Save the Y, YdotI, YdotRHS for extrapolation initial guess */</font>
<a name="line843">843: </a>      <font color="#4169E1">if</font> (ark-&gt;init_guess_extrp) {
<a name="line844">844: </a>        <font color="#4169E1">for</font> (i = 0; i&lt;s; i++) {
<a name="line845">845: </a>          <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(Y[i],ark-&gt;Y_prev[i]);
<a name="line846">846: </a>          <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(YdotRHS[i],ark-&gt;YdotRHS_prev[i]);
<a name="line847">847: </a>          <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(YdotI[i],ark-&gt;YdotI_prev[i]);
<a name="line848">848: </a>        }
<a name="line849">849: </a>        ark-&gt;prev_step_valid = <a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;
<a name="line850">850: </a>      }
<a name="line851">851: </a>      <font color="#4169E1">break</font>;
<a name="line852">852: </a>    } <font color="#4169E1">else</font> {                    <font color="#B22222">/* Roll back the current step */</font>
<a name="line853">853: </a>      ts-&gt;ptime += next_time_step; <font color="#B22222">/* This will be undone in rollback */</font>
<a name="line854">854: </a>      ark-&gt;status = TS_STEP_INCOMPLETE;
<a name="line855">855: </a>      <a href="../../../../docs/manualpages/TS/TSRollBack.html#TSRollBack">TSRollBack</a>(ts);
<a name="line856">856: </a>    }
<a name="line857">857: </a><strong><font color="#FF0000">reject_step:</font></strong> <font color="#4169E1">continue</font>;
<a name="line858">858: </a>  }
<a name="line859">859: </a>  <font color="#4169E1">if</font> (ark-&gt;status != TS_STEP_COMPLETE &amp;&amp; !ts-&gt;reason) ts-&gt;reason = <a href="../../../../docs/manualpages/TS/TS_DIVERGED_STEP_REJECTED.html#TS_DIVERGED_STEP_REJECTED">TS_DIVERGED_STEP_REJECTED</a>;
<a name="line860">860: </a>  <font color="#4169E1">return</font>(0);
<a name="line861">861: </a>}

<a name="line865">865: </a><strong><font color="#4169E1"><a name="TSInterpolate_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSInterpolate_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> itime,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> X)</font></strong>
<a name="line866">866: </a>{
<a name="line867">867: </a>  TS_ARKIMEX      *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line868">868: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        s    = ark-&gt;tableau-&gt;s,pinterp = ark-&gt;tableau-&gt;pinterp,i,j;
<a name="line869">869: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>       h;
<a name="line870">870: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>       tt,t;
<a name="line871">871: </a>  <a href="../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a>     *bt,*b;
<a name="line872">872: </a>  const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *Bt = ark-&gt;tableau-&gt;binterpt,*B = ark-&gt;tableau-&gt;binterp;
<a name="line873">873: </a>  <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  ierr;

<a name="line876">876: </a>  <font color="#4169E1">if</font> (!Bt || !B) <a href="../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts),PETSC_ERR_SUP,<font color="#666666">"<a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a> %s does not have an interpolation formula"</font>,ark-&gt;tableau-&gt;name);
<a name="line877">877: </a>  <font color="#4169E1">switch</font> (ark-&gt;status) {
<a name="line878">878: </a>  <font color="#4169E1">case</font> TS_STEP_INCOMPLETE:
<a name="line879">879: </a>  <font color="#4169E1">case</font> TS_STEP_PENDING:
<a name="line880">880: </a>    h = ts-&gt;time_step;
<a name="line881">881: </a>    t = (itime - ts-&gt;ptime)/h;
<a name="line882">882: </a>    <font color="#4169E1">break</font>;
<a name="line883">883: </a>  <font color="#4169E1">case</font> TS_STEP_COMPLETE:
<a name="line884">884: </a>    h = ts-&gt;time_step_prev;
<a name="line885">885: </a>    t = (itime - ts-&gt;ptime)/h + 1; <font color="#B22222">/* In the interval [0,1] */</font>
<a name="line886">886: </a>    <font color="#4169E1">break</font>;
<a name="line887">887: </a><strong><font color="#FF0000">  default:</font></strong> <a href="../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts),PETSC_ERR_PLIB,<font color="#666666">"Invalid TSStepStatus"</font>);
<a name="line888">888: </a>  }
<a name="line889">889: </a>  <a href="../../../../docs/manualpages/Sys/PetscMalloc2.html#PetscMalloc2">PetscMalloc2</a>(s,&amp;bt,s,&amp;b);
<a name="line890">890: </a>  <font color="#4169E1">for</font> (i=0; i&lt;s; i++) bt[i] = b[i] = 0;
<a name="line891">891: </a>  <font color="#4169E1">for</font> (j=0,tt=t; j&lt;pinterp; j++,tt*=t) {
<a name="line892">892: </a>    <font color="#4169E1">for</font> (i=0; i&lt;s; i++) {
<a name="line893">893: </a>      bt[i] += h * Bt[i*pinterp+j] * tt;
<a name="line894">894: </a>      b[i]  += h * B[i*pinterp+j] * tt;
<a name="line895">895: </a>    }
<a name="line896">896: </a>  }
<a name="line897">897: </a>  <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(ark-&gt;Y[0],X);
<a name="line898">898: </a>  <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(X,s,bt,ark-&gt;YdotI);
<a name="line899">899: </a>  <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(X,s,b,ark-&gt;YdotRHS);
<a name="line900">900: </a>  <a href="../../../../docs/manualpages/Sys/PetscFree2.html#PetscFree2">PetscFree2</a>(bt,b);
<a name="line901">901: </a>  <font color="#4169E1">return</font>(0);
<a name="line902">902: </a>}

<a name="line906">906: </a><strong><font color="#4169E1"><a name="TSExtrapolate_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSExtrapolate_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> c,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> X)</font></strong>
<a name="line907">907: </a>{
<a name="line908">908: </a>  TS_ARKIMEX      *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line909">909: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>        s    = ark-&gt;tableau-&gt;s,pinterp = ark-&gt;tableau-&gt;pinterp,i,j;
<a name="line910">910: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>       h;
<a name="line911">911: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>       tt,t;
<a name="line912">912: </a>  <a href="../../../../docs/manualpages/Sys/PetscScalar.html#PetscScalar">PetscScalar</a>     *bt,*b;
<a name="line913">913: </a>  const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> *Bt = ark-&gt;tableau-&gt;binterpt,*B = ark-&gt;tableau-&gt;binterp;
<a name="line914">914: </a>  <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  ierr;

<a name="line917">917: </a>  <font color="#4169E1">if</font> (!Bt || !B) <a href="../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts),PETSC_ERR_SUP,<font color="#666666">"<a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a> %s does not have an interpolation formula"</font>,ark-&gt;tableau-&gt;name);
<a name="line918">918: </a>  t = 1.0 + (ts-&gt;time_step/ts-&gt;time_step_prev)*c;
<a name="line919">919: </a>  h = ts-&gt;time_step;
<a name="line920">920: </a>  <a href="../../../../docs/manualpages/Sys/PetscMalloc2.html#PetscMalloc2">PetscMalloc2</a>(s,&amp;bt,s,&amp;b);
<a name="line921">921: </a>  <font color="#4169E1">for</font> (i=0; i&lt;s; i++) bt[i] = b[i] = 0;
<a name="line922">922: </a>  <font color="#4169E1">for</font> (j=0,tt=t; j&lt;pinterp; j++,tt*=t) {
<a name="line923">923: </a>    <font color="#4169E1">for</font> (i=0; i&lt;s; i++) {
<a name="line924">924: </a>      bt[i] += h * Bt[i*pinterp+j] * tt;
<a name="line925">925: </a>      b[i]  += h * B[i*pinterp+j] * tt;
<a name="line926">926: </a>    }
<a name="line927">927: </a>  }
<a name="line928">928: </a>  <font color="#4169E1">if</font> (!ark-&gt;prev_step_valid) <a href="../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts),PETSC_ERR_SUP,<font color="#666666">"Stages from previous step have not been stored"</font>);
<a name="line929">929: </a>  <a href="../../../../docs/manualpages/Vec/VecCopy.html#VecCopy">VecCopy</a>(ark-&gt;Y_prev[0],X);
<a name="line930">930: </a>  <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(X,s,bt,ark-&gt;YdotI_prev);
<a name="line931">931: </a>  <a href="../../../../docs/manualpages/Vec/VecMAXPY.html#VecMAXPY">VecMAXPY</a>(X,s,b,ark-&gt;YdotRHS_prev);
<a name="line932">932: </a>  <a href="../../../../docs/manualpages/Sys/PetscFree2.html#PetscFree2">PetscFree2</a>(bt,b);
<a name="line933">933: </a>  <font color="#4169E1">return</font>(0);
<a name="line934">934: </a>}

<a name="line936">936: </a><font color="#B22222">/*------------------------------------------------------------*/</font>
<a name="line939">939: </a><strong><font color="#4169E1"><a name="TSReset_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSReset_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts)</font></strong>
<a name="line940">940: </a>{
<a name="line941">941: </a>  TS_ARKIMEX     *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line942">942: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       s;

<a name="line946">946: </a>  <font color="#4169E1">if</font> (!ark-&gt;tableau) <font color="#4169E1">return</font>(0);
<a name="line947">947: </a>  s    = ark-&gt;tableau-&gt;s;
<a name="line948">948: </a>  <a href="../../../../docs/manualpages/Vec/VecDestroyVecs.html#VecDestroyVecs">VecDestroyVecs</a>(s,&amp;ark-&gt;Y);
<a name="line949">949: </a>  <a href="../../../../docs/manualpages/Vec/VecDestroyVecs.html#VecDestroyVecs">VecDestroyVecs</a>(s,&amp;ark-&gt;YdotI);
<a name="line950">950: </a>  <a href="../../../../docs/manualpages/Vec/VecDestroyVecs.html#VecDestroyVecs">VecDestroyVecs</a>(s,&amp;ark-&gt;YdotRHS);
<a name="line951">951: </a>  <font color="#4169E1">if</font> (ark-&gt;init_guess_extrp) {
<a name="line952">952: </a>    <a href="../../../../docs/manualpages/Vec/VecDestroyVecs.html#VecDestroyVecs">VecDestroyVecs</a>(s,&amp;ark-&gt;Y_prev);
<a name="line953">953: </a>    <a href="../../../../docs/manualpages/Vec/VecDestroyVecs.html#VecDestroyVecs">VecDestroyVecs</a>(s,&amp;ark-&gt;YdotI_prev);
<a name="line954">954: </a>    <a href="../../../../docs/manualpages/Vec/VecDestroyVecs.html#VecDestroyVecs">VecDestroyVecs</a>(s,&amp;ark-&gt;YdotRHS_prev);
<a name="line955">955: </a>  }
<a name="line956">956: </a>  <a href="../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;ark-&gt;Ydot);
<a name="line957">957: </a>  <a href="../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;ark-&gt;Work);
<a name="line958">958: </a>  <a href="../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;ark-&gt;Ydot0);
<a name="line959">959: </a>  <a href="../../../../docs/manualpages/Vec/VecDestroy.html#VecDestroy">VecDestroy</a>(&amp;ark-&gt;Z);
<a name="line960">960: </a>  <a href="../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(ark-&gt;work);
<a name="line961">961: </a>  <font color="#4169E1">return</font>(0);
<a name="line962">962: </a>}

<a name="line966">966: </a><strong><font color="#4169E1"><a name="TSDestroy_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSDestroy_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts)</font></strong>
<a name="line967">967: </a>{

<a name="line971">971: </a>  TSReset_ARKIMEX(ts);
<a name="line972">972: </a>  <a href="../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(ts-&gt;data);
<a name="line973">973: </a>  <a href="../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts,<font color="#666666">"TSARKIMEXGetType_C"</font>,NULL);
<a name="line974">974: </a>  <a href="../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts,<font color="#666666">"TSARKIMEXSetType_C"</font>,NULL);
<a name="line975">975: </a>  <a href="../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts,<font color="#666666">"TSARKIMEXSetFullyImplicit_C"</font>,NULL);
<a name="line976">976: </a>  <font color="#4169E1">return</font>(0);
<a name="line977">977: </a>}


<a name="line982">982: </a><strong><font color="#4169E1"><a name="TSARKIMEXGetVecs"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSARKIMEXGetVecs(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a> dm,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> *Z,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> *Ydot)</font></strong>
<a name="line983">983: </a>{
<a name="line984">984: </a>  TS_ARKIMEX     *ax = (TS_ARKIMEX*)ts-&gt;data;

<a name="line988">988: </a>  <font color="#4169E1">if</font> (Z) {
<a name="line989">989: </a>    <font color="#4169E1">if</font> (dm &amp;&amp; dm != ts-&gt;dm) {
<a name="line990">990: </a>      <a href="../../../../docs/manualpages/DM/DMGetNamedGlobalVector.html#DMGetNamedGlobalVector">DMGetNamedGlobalVector</a>(dm,<font color="#666666">"TSARKIMEX_Z"</font>,Z);
<a name="line991">991: </a>    } <font color="#4169E1">else</font> *Z = ax-&gt;Z;
<a name="line992">992: </a>  }
<a name="line993">993: </a>  <font color="#4169E1">if</font> (Ydot) {
<a name="line994">994: </a>    <font color="#4169E1">if</font> (dm &amp;&amp; dm != ts-&gt;dm) {
<a name="line995">995: </a>      <a href="../../../../docs/manualpages/DM/DMGetNamedGlobalVector.html#DMGetNamedGlobalVector">DMGetNamedGlobalVector</a>(dm,<font color="#666666">"TSARKIMEX_Ydot"</font>,Ydot);
<a name="line996">996: </a>    } <font color="#4169E1">else</font> *Ydot = ax-&gt;Ydot;
<a name="line997">997: </a>  }
<a name="line998">998: </a>  <font color="#4169E1">return</font>(0);
<a name="line999">999: </a>}


<a name="line1004">1004: </a><strong><font color="#4169E1"><a name="TSARKIMEXRestoreVecs"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSARKIMEXRestoreVecs(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a> dm,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> *Z,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> *Ydot)</font></strong>
<a name="line1005">1005: </a>{

<a name="line1009">1009: </a>  <font color="#4169E1">if</font> (Z) {
<a name="line1010">1010: </a>    <font color="#4169E1">if</font> (dm &amp;&amp; dm != ts-&gt;dm) {
<a name="line1011">1011: </a>      <a href="../../../../docs/manualpages/DM/DMRestoreNamedGlobalVector.html#DMRestoreNamedGlobalVector">DMRestoreNamedGlobalVector</a>(dm,<font color="#666666">"TSARKIMEX_Z"</font>,Z);
<a name="line1012">1012: </a>    }
<a name="line1013">1013: </a>  }
<a name="line1014">1014: </a>  <font color="#4169E1">if</font> (Ydot) {
<a name="line1015">1015: </a>    <font color="#4169E1">if</font> (dm &amp;&amp; dm != ts-&gt;dm) {
<a name="line1016">1016: </a>      <a href="../../../../docs/manualpages/DM/DMRestoreNamedGlobalVector.html#DMRestoreNamedGlobalVector">DMRestoreNamedGlobalVector</a>(dm,<font color="#666666">"TSARKIMEX_Ydot"</font>,Ydot);
<a name="line1017">1017: </a>    }
<a name="line1018">1018: </a>  }
<a name="line1019">1019: </a>  <font color="#4169E1">return</font>(0);
<a name="line1020">1020: </a>}

<a name="line1022">1022: </a><font color="#B22222">/*</font>
<a name="line1023">1023: </a><font color="#B22222">  This defines the nonlinear equation that is to be solved with <a href="../../../../docs/manualpages/SNES/SNES.html#SNES">SNES</a></font>
<a name="line1024">1024: </a><font color="#B22222">  G(U) = F[t0+Theta*dt, U, (U-U0)*shift] = 0</font>
<a name="line1025">1025: </a><font color="#B22222">*/</font>
<a name="line1028">1028: </a><strong><font color="#4169E1"><a name="SNESTSFormFunction_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> SNESTSFormFunction_ARKIMEX(<a href="../../../../docs/manualpages/SNES/SNES.html#SNES">SNES</a> snes,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> X,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> F,<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts)</font></strong>
<a name="line1029">1029: </a>{
<a name="line1030">1030: </a>  TS_ARKIMEX     *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line1031">1031: </a>  <a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a>             dm,dmsave;
<a name="line1032">1032: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>            Z,Ydot;
<a name="line1033">1033: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>      shift = ark-&gt;scoeff / ts-&gt;time_step;

<a name="line1037">1037: </a>  <a href="../../../../docs/manualpages/SNES/SNESGetDM.html#SNESGetDM">SNESGetDM</a>(snes,&amp;dm);
<a name="line1038">1038: </a>  TSARKIMEXGetVecs(ts,dm,&amp;Z,&amp;Ydot);
<a name="line1039">1039: </a>  <a href="../../../../docs/manualpages/Vec/VecAXPBYPCZ.html#VecAXPBYPCZ">VecAXPBYPCZ</a>(Ydot,-shift,shift,0,Z,X); <font color="#B22222">/* Ydot = shift*(X-Z) */</font>
<a name="line1040">1040: </a>  dmsave = ts-&gt;dm;
<a name="line1041">1041: </a>  ts-&gt;dm = dm;

<a name="line1043">1043: </a>  <a href="../../../../docs/manualpages/TS/TSComputeIFunction.html#TSComputeIFunction">TSComputeIFunction</a>(ts,ark-&gt;stage_time,X,Ydot,F,ark-&gt;imex);

<a name="line1045">1045: </a>  ts-&gt;dm = dmsave;
<a name="line1046">1046: </a>  TSARKIMEXRestoreVecs(ts,dm,&amp;Z,&amp;Ydot);
<a name="line1047">1047: </a>  <font color="#4169E1">return</font>(0);
<a name="line1048">1048: </a>}

<a name="line1052">1052: </a><strong><font color="#4169E1"><a name="SNESTSFormJacobian_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> SNESTSFormJacobian_ARKIMEX(<a href="../../../../docs/manualpages/SNES/SNES.html#SNES">SNES</a> snes,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> X,<a href="../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> A,<a href="../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> B,<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts)</font></strong>
<a name="line1053">1053: </a>{
<a name="line1054">1054: </a>  TS_ARKIMEX     *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line1055">1055: </a>  <a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a>             dm,dmsave;
<a name="line1056">1056: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>            Ydot;
<a name="line1057">1057: </a>  <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a>      shift = ark-&gt;scoeff / ts-&gt;time_step;

<a name="line1061">1061: </a>  <a href="../../../../docs/manualpages/SNES/SNESGetDM.html#SNESGetDM">SNESGetDM</a>(snes,&amp;dm);
<a name="line1062">1062: </a>  TSARKIMEXGetVecs(ts,dm,NULL,&amp;Ydot);
<a name="line1063">1063: </a>  <font color="#B22222">/* ark-&gt;Ydot has already been computed in SNESTSFormFunction_ARKIMEX (<a href="../../../../docs/manualpages/SNES/SNES.html#SNES">SNES</a> guarantees this) */</font>
<a name="line1064">1064: </a>  dmsave = ts-&gt;dm;
<a name="line1065">1065: </a>  ts-&gt;dm = dm;

<a name="line1067">1067: </a>  <a href="../../../../docs/manualpages/TS/TSComputeIJacobian.html#TSComputeIJacobian">TSComputeIJacobian</a>(ts,ark-&gt;stage_time,X,Ydot,shift,A,B,ark-&gt;imex);

<a name="line1069">1069: </a>  ts-&gt;dm = dmsave;
<a name="line1070">1070: </a>  TSARKIMEXRestoreVecs(ts,dm,NULL,&amp;Ydot);
<a name="line1071">1071: </a>  <font color="#4169E1">return</font>(0);
<a name="line1072">1072: </a>}

<a name="line1076">1076: </a><strong><font color="#4169E1"><a name="DMCoarsenHook_TSARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> DMCoarsenHook_TSARKIMEX(<a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a> fine,<a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a> coarse,void *ctx)</font></strong>
<a name="line1077">1077: </a>{
<a name="line1079">1079: </a>  <font color="#4169E1">return</font>(0);
<a name="line1080">1080: </a>}

<a name="line1084">1084: </a><strong><font color="#4169E1"><a name="DMRestrictHook_TSARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> DMRestrictHook_TSARKIMEX(<a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a> fine,<a href="../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> restrct,<a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a> rscale,<a href="../../../../docs/manualpages/Mat/Mat.html#Mat">Mat</a> inject,<a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a> coarse,void *ctx)</font></strong>
<a name="line1085">1085: </a>{
<a name="line1086">1086: </a>  <a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>             ts = (<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>)ctx;
<a name="line1088">1088: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>            Z,Z_c;

<a name="line1091">1091: </a>  TSARKIMEXGetVecs(ts,fine,&amp;Z,NULL);
<a name="line1092">1092: </a>  TSARKIMEXGetVecs(ts,coarse,&amp;Z_c,NULL);
<a name="line1093">1093: </a>  <a href="../../../../docs/manualpages/Mat/MatRestrict.html#MatRestrict">MatRestrict</a>(restrct,Z,Z_c);
<a name="line1094">1094: </a>  <a href="../../../../docs/manualpages/Vec/VecPointwiseMult.html#VecPointwiseMult">VecPointwiseMult</a>(Z_c,rscale,Z_c);
<a name="line1095">1095: </a>  TSARKIMEXRestoreVecs(ts,fine,&amp;Z,NULL);
<a name="line1096">1096: </a>  TSARKIMEXRestoreVecs(ts,coarse,&amp;Z_c,NULL);
<a name="line1097">1097: </a>  <font color="#4169E1">return</font>(0);
<a name="line1098">1098: </a>}


<a name="line1103">1103: </a><strong><font color="#4169E1"><a name="DMSubDomainHook_TSARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> DMSubDomainHook_TSARKIMEX(<a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a> dm,<a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a> subdm,void *ctx)</font></strong>
<a name="line1104">1104: </a>{
<a name="line1106">1106: </a>  <font color="#4169E1">return</font>(0);
<a name="line1107">1107: </a>}

<a name="line1111">1111: </a><strong><font color="#4169E1"><a name="DMSubDomainRestrictHook_TSARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> DMSubDomainRestrictHook_TSARKIMEX(<a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a> dm,<a href="../../../../docs/manualpages/Vec/VecScatter.html#VecScatter">VecScatter</a> gscat,<a href="../../../../docs/manualpages/Vec/VecScatter.html#VecScatter">VecScatter</a> lscat,<a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a> subdm,void *ctx)</font></strong>
<a name="line1112">1112: </a>{
<a name="line1113">1113: </a>  <a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>             ts = (<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>)ctx;
<a name="line1115">1115: </a>  <a href="../../../../docs/manualpages/Vec/Vec.html#Vec">Vec</a>            Z,Z_c;

<a name="line1118">1118: </a>  TSARKIMEXGetVecs(ts,dm,&amp;Z,NULL);
<a name="line1119">1119: </a>  TSARKIMEXGetVecs(ts,subdm,&amp;Z_c,NULL);

<a name="line1121">1121: </a>  <a href="../../../../docs/manualpages/Vec/VecScatterBegin.html#VecScatterBegin">VecScatterBegin</a>(gscat,Z,Z_c,<a href="../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);
<a name="line1122">1122: </a>  <a href="../../../../docs/manualpages/Vec/VecScatterEnd.html#VecScatterEnd">VecScatterEnd</a>(gscat,Z,Z_c,<a href="../../../../docs/manualpages/Sys/INSERT_VALUES.html#INSERT_VALUES">INSERT_VALUES</a>,<a href="../../../../docs/manualpages/Vec/SCATTER_FORWARD.html#SCATTER_FORWARD">SCATTER_FORWARD</a>);

<a name="line1124">1124: </a>  TSARKIMEXRestoreVecs(ts,dm,&amp;Z,NULL);
<a name="line1125">1125: </a>  TSARKIMEXRestoreVecs(ts,subdm,&amp;Z_c,NULL);
<a name="line1126">1126: </a>  <font color="#4169E1">return</font>(0);
<a name="line1127">1127: </a>}

<a name="line1131">1131: </a><strong><font color="#4169E1"><a name="TSSetUp_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSSetUp_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts)</font></strong>
<a name="line1132">1132: </a>{
<a name="line1133">1133: </a>  TS_ARKIMEX     *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line1134">1134: </a>  ARKTableau     tab;
<a name="line1135">1135: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       s;
<a name="line1137">1137: </a>  <a href="../../../../docs/manualpages/DM/DM.html#DM">DM</a>             dm;

<a name="line1140">1140: </a>  <font color="#4169E1">if</font> (!ark-&gt;tableau) {
<a name="line1141">1141: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXSetType.html#TSARKIMEXSetType">TSARKIMEXSetType</a>(ts,TSARKIMEXDefault);
<a name="line1142">1142: </a>  }
<a name="line1143">1143: </a>  tab  = ark-&gt;tableau;
<a name="line1144">1144: </a>  s    = tab-&gt;s;
<a name="line1145">1145: </a>  <a href="../../../../docs/manualpages/Vec/VecDuplicateVecs.html#VecDuplicateVecs">VecDuplicateVecs</a>(ts-&gt;vec_sol,s,&amp;ark-&gt;Y);
<a name="line1146">1146: </a>  <a href="../../../../docs/manualpages/Vec/VecDuplicateVecs.html#VecDuplicateVecs">VecDuplicateVecs</a>(ts-&gt;vec_sol,s,&amp;ark-&gt;YdotI);
<a name="line1147">1147: </a>  <a href="../../../../docs/manualpages/Vec/VecDuplicateVecs.html#VecDuplicateVecs">VecDuplicateVecs</a>(ts-&gt;vec_sol,s,&amp;ark-&gt;YdotRHS);
<a name="line1148">1148: </a>  <font color="#4169E1">if</font> (ark-&gt;init_guess_extrp) {
<a name="line1149">1149: </a>    <a href="../../../../docs/manualpages/Vec/VecDuplicateVecs.html#VecDuplicateVecs">VecDuplicateVecs</a>(ts-&gt;vec_sol,s,&amp;ark-&gt;Y_prev);
<a name="line1150">1150: </a>    <a href="../../../../docs/manualpages/Vec/VecDuplicateVecs.html#VecDuplicateVecs">VecDuplicateVecs</a>(ts-&gt;vec_sol,s,&amp;ark-&gt;YdotI_prev);
<a name="line1151">1151: </a>    <a href="../../../../docs/manualpages/Vec/VecDuplicateVecs.html#VecDuplicateVecs">VecDuplicateVecs</a>(ts-&gt;vec_sol,s,&amp;ark-&gt;YdotRHS_prev);
<a name="line1152">1152: </a>  }
<a name="line1153">1153: </a>  <a href="../../../../docs/manualpages/Vec/VecDuplicate.html#VecDuplicate">VecDuplicate</a>(ts-&gt;vec_sol,&amp;ark-&gt;Ydot);
<a name="line1154">1154: </a>  <a href="../../../../docs/manualpages/Vec/VecDuplicate.html#VecDuplicate">VecDuplicate</a>(ts-&gt;vec_sol,&amp;ark-&gt;Work);
<a name="line1155">1155: </a>  <a href="../../../../docs/manualpages/Vec/VecDuplicate.html#VecDuplicate">VecDuplicate</a>(ts-&gt;vec_sol,&amp;ark-&gt;Ydot0);
<a name="line1156">1156: </a>  <a href="../../../../docs/manualpages/Vec/VecDuplicate.html#VecDuplicate">VecDuplicate</a>(ts-&gt;vec_sol,&amp;ark-&gt;Z);
<a name="line1157">1157: </a>  <a href="../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(s,&amp;ark-&gt;work);
<a name="line1158">1158: </a>  <a href="../../../../docs/manualpages/TS/TSGetDM.html#TSGetDM">TSGetDM</a>(ts,&amp;dm);
<a name="line1159">1159: </a>  <font color="#4169E1">if</font> (dm) {
<a name="line1160">1160: </a>    <a href="../../../../docs/manualpages/DM/DMCoarsenHookAdd.html#DMCoarsenHookAdd">DMCoarsenHookAdd</a>(dm,DMCoarsenHook_TSARKIMEX,DMRestrictHook_TSARKIMEX,ts);
<a name="line1161">1161: </a>    <a href="../../../../docs/manualpages/DM/DMSubDomainHookAdd.html#DMSubDomainHookAdd">DMSubDomainHookAdd</a>(dm,DMSubDomainHook_TSARKIMEX,DMSubDomainRestrictHook_TSARKIMEX,ts);
<a name="line1162">1162: </a>  }
<a name="line1163">1163: </a>  <font color="#4169E1">return</font>(0);
<a name="line1164">1164: </a>}
<a name="line1165">1165: </a><font color="#B22222">/*------------------------------------------------------------*/</font>

<a name="line1169">1169: </a><strong><font color="#4169E1"><a name="TSSetFromOptions_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSSetFromOptions_ARKIMEX(PetscOptions *PetscOptionsObject,<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts)</font></strong>
<a name="line1170">1170: </a>{
<a name="line1171">1171: </a>  TS_ARKIMEX     *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line1173">1173: </a>  char           arktype[256];

<a name="line1176">1176: </a>  <a href="../../../../docs/manualpages/Sys/PetscOptionsHead.html#PetscOptionsHead">PetscOptionsHead</a>(PetscOptionsObject,<font color="#666666">"ARKIMEX ODE solver options"</font>);
<a name="line1177">1177: </a>  {
<a name="line1178">1178: </a>    ARKTableauLink link;
<a name="line1179">1179: </a>    <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       count,choice;
<a name="line1180">1180: </a>    <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      flg;
<a name="line1181">1181: </a>    const char     **namelist;
<a name="line1182">1182: </a>    <a href="../../../../docs/manualpages/Sys/PetscStrncpy.html#PetscStrncpy">PetscStrncpy</a>(arktype,TSARKIMEXDefault,<font color="#4169E1">sizeof</font>(arktype));
<a name="line1183">1183: </a>    <font color="#4169E1">for</font> (link=ARKTableauList,count=0; link; link=link-&gt;next,count++) ;
<a name="line1184">1184: </a>    <a href="../../../../docs/manualpages/Sys/PetscMalloc1.html#PetscMalloc1">PetscMalloc1</a>(count,&amp;namelist);
<a name="line1185">1185: </a>    <font color="#4169E1">for</font> (link=ARKTableauList,count=0; link; link=link-&gt;next,count++) namelist[count] = link-&gt;tab.name;
<a name="line1186">1186: </a>      <a href="../../../../docs/manualpages/Sys/PetscOptionsEList.html#PetscOptionsEList">PetscOptionsEList</a>(<font color="#666666">"-ts_arkimex_type"</font>,<font color="#666666">"Family of ARK IMEX method"</font>,<font color="#666666">"<a href="../../../../docs/manualpages/TS/TSARKIMEXSetType.html#TSARKIMEXSetType">TSARKIMEXSetType</a>"</font>,(const char*const*)namelist,count,arktype,&amp;choice,&amp;flg);
<a name="line1187">1187: </a>      <a href="../../../../docs/manualpages/TS/TSARKIMEXSetType.html#TSARKIMEXSetType">TSARKIMEXSetType</a>(ts,flg ? namelist[choice] : arktype);
<a name="line1188">1188: </a>    <a href="../../../../docs/manualpages/Sys/PetscFree.html#PetscFree">PetscFree</a>(namelist);
<a name="line1189">1189: </a>    flg       = (<a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>) !ark-&gt;imex;
<a name="line1190">1190: </a>    <a href="../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-ts_arkimex_fully_implicit"</font>,<font color="#666666">"Solve the problem fully implicitly"</font>,<font color="#666666">"<a href="../../../../docs/manualpages/TS/TSARKIMEXSetFullyImplicit.html#TSARKIMEXSetFullyImplicit">TSARKIMEXSetFullyImplicit</a>"</font>,flg,&amp;flg,NULL);
<a name="line1191">1191: </a>    ark-&gt;imex = (<a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>) !flg;
<a name="line1192">1192: </a>    ark-&gt;init_guess_extrp = <a href="../../../../docs/manualpages/Sys/PETSC_FALSE.html#PETSC_FALSE">PETSC_FALSE</a>;
<a name="line1193">1193: </a>    <a href="../../../../docs/manualpages/Sys/PetscOptionsBool.html#PetscOptionsBool">PetscOptionsBool</a>(<font color="#666666">"-ts_arkimex_initial_guess_extrapolate"</font>,<font color="#666666">"Extrapolate the initial guess for the stage solution from stage values of the previous time step"</font>,<font color="#666666">""</font>,ark-&gt;init_guess_extrp,&amp;ark-&gt;init_guess_extrp,NULL);
<a name="line1194">1194: </a>  }
<a name="line1195">1195: </a>  <a href="../../../../docs/manualpages/Sys/PetscOptionsTail.html#PetscOptionsTail">PetscOptionsTail</a>();
<a name="line1196">1196: </a>  <font color="#4169E1">return</font>(0);
<a name="line1197">1197: </a>}

<a name="line1201">1201: </a><strong><font color="#4169E1"><a name="PetscFormatRealArray"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> PetscFormatRealArray(char buf[],size_t len,const char *fmt,<a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a> n,const <a href="../../../../docs/manualpages/Sys/PetscReal.html#PetscReal">PetscReal</a> x[])</font></strong>
<a name="line1202">1202: </a>{
<a name="line1204">1204: </a>  <a href="../../../../docs/manualpages/Sys/PetscInt.html#PetscInt">PetscInt</a>       i;
<a name="line1205">1205: </a>  size_t         left,count;
<a name="line1206">1206: </a>  char           *p;

<a name="line1209">1209: </a>  <font color="#4169E1">for</font> (i=0,p=buf,left=len; i&lt;n; i++) {
<a name="line1210">1210: </a>    <a href="../../../../docs/manualpages/Sys/PetscSNPrintfCount.html#PetscSNPrintfCount">PetscSNPrintfCount</a>(p,left,fmt,&amp;count,x[i]);
<a name="line1211">1211: </a>    <font color="#4169E1">if</font> (count &gt;= left) <a href="../../../../docs/manualpages/Sys/SETERRQ.html#SETERRQ">SETERRQ</a>(<a href="../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html#PETSC_COMM_SELF">PETSC_COMM_SELF</a>,PETSC_ERR_ARG_OUTOFRANGE,<font color="#666666">"Insufficient space in buffer"</font>);
<a name="line1212">1212: </a>    left -= count;
<a name="line1213">1213: </a>    p    += count;
<a name="line1214">1214: </a>    *p++  = ' ';
<a name="line1215">1215: </a>  }
<a name="line1216">1216: </a>  p[i ? 0 : -1] = 0;
<a name="line1217">1217: </a>  <font color="#4169E1">return</font>(0);
<a name="line1218">1218: </a>}

<a name="line1222">1222: </a><strong><font color="#4169E1"><a name="TSView_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSView_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> viewer)</font></strong>
<a name="line1223">1223: </a>{
<a name="line1224">1224: </a>  TS_ARKIMEX     *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line1225">1225: </a>  ARKTableau     tab  = ark-&gt;tableau;
<a name="line1226">1226: </a>  <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      iascii;
<a name="line1228">1228: </a>  <a href="../../../../docs/manualpages/TS/TSAdapt.html#TSAdapt">TSAdapt</a>        adapt;

<a name="line1231">1231: </a>  <a href="../../../../docs/manualpages/Sys/PetscObjectTypeCompare.html#PetscObjectTypeCompare">PetscObjectTypeCompare</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)viewer,PETSCVIEWERASCII,&amp;iascii);
<a name="line1232">1232: </a>  <font color="#4169E1">if</font> (iascii) {
<a name="line1233">1233: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXType.html#TSARKIMEXType">TSARKIMEXType</a> arktype;
<a name="line1234">1234: </a>    char          buf[512];
<a name="line1235">1235: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXGetType.html#TSARKIMEXGetType">TSARKIMEXGetType</a>(ts,&amp;arktype);
<a name="line1236">1236: </a>    <a href="../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,<font color="#666666">"  ARK IMEX %s\n"</font>,arktype);
<a name="line1237">1237: </a>    PetscFormatRealArray(buf,<font color="#4169E1">sizeof</font>(buf),<font color="#666666">"% 8.6f"</font>,tab-&gt;s,tab-&gt;ct);
<a name="line1238">1238: </a>    <a href="../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,<font color="#666666">"  Stiff abscissa       ct = %s\n"</font>,buf);
<a name="line1239">1239: </a>    PetscFormatRealArray(buf,<font color="#4169E1">sizeof</font>(buf),<font color="#666666">"% 8.6f"</font>,tab-&gt;s,tab-&gt;c);
<a name="line1240">1240: </a>    <a href="../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,<font color="#666666">"Stiffly accurate: %s\n"</font>,tab-&gt;stiffly_accurate ? <font color="#666666">"yes"</font> : <font color="#666666">"no"</font>);
<a name="line1241">1241: </a>    <a href="../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,<font color="#666666">"Explicit first stage: %s\n"</font>,tab-&gt;explicit_first_stage ? <font color="#666666">"yes"</font> : <font color="#666666">"no"</font>);
<a name="line1242">1242: </a>    <a href="../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,<font color="#666666">"FSAL property: %s\n"</font>,tab-&gt;FSAL_implicit ? <font color="#666666">"yes"</font> : <font color="#666666">"no"</font>);
<a name="line1243">1243: </a>    <a href="../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html#PetscViewerASCIIPrintf">PetscViewerASCIIPrintf</a>(viewer,<font color="#666666">"  Nonstiff abscissa     c = %s\n"</font>,buf);
<a name="line1244">1244: </a>  }
<a name="line1245">1245: </a>  <a href="../../../../docs/manualpages/TS/TSGetAdapt.html#TSGetAdapt">TSGetAdapt</a>(ts,&amp;adapt);
<a name="line1246">1246: </a>  TSAdaptView(adapt,viewer);
<a name="line1247">1247: </a>  <a href="../../../../docs/manualpages/SNES/SNESView.html#SNESView">SNESView</a>(ts-&gt;snes,viewer);
<a name="line1248">1248: </a>  <font color="#4169E1">return</font>(0);
<a name="line1249">1249: </a>}

<a name="line1253">1253: </a><strong><font color="#4169E1"><a name="TSLoad_ARKIMEX"></a>static <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSLoad_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/Viewer/PetscViewer.html#PetscViewer">PetscViewer</a> viewer)</font></strong>
<a name="line1254">1254: </a>{
<a name="line1256">1256: </a>  <a href="../../../../docs/manualpages/SNES/SNES.html#SNES">SNES</a>           snes;
<a name="line1257">1257: </a>  <a href="../../../../docs/manualpages/TS/TSAdapt.html#TSAdapt">TSAdapt</a>        tsadapt;

<a name="line1260">1260: </a>  <a href="../../../../docs/manualpages/TS/TSGetAdapt.html#TSGetAdapt">TSGetAdapt</a>(ts,&amp;tsadapt);
<a name="line1261">1261: </a>  <a href="../../../../docs/manualpages/TS/TSAdaptLoad.html#TSAdaptLoad">TSAdaptLoad</a>(tsadapt,viewer);
<a name="line1262">1262: </a>  <a href="../../../../docs/manualpages/TS/TSGetSNES.html#TSGetSNES">TSGetSNES</a>(ts,&amp;snes);
<a name="line1263">1263: </a>  <a href="../../../../docs/manualpages/SNES/SNESLoad.html#SNESLoad">SNESLoad</a>(snes,viewer);
<a name="line1264">1264: </a>  <font color="#B22222">/* function and Jacobian context for <a href="../../../../docs/manualpages/SNES/SNES.html#SNES">SNES</a> when used with <a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> is always ts object */</font>
<a name="line1265">1265: </a>  <a href="../../../../docs/manualpages/SNES/SNESSetFunction.html#SNESSetFunction">SNESSetFunction</a>(snes,NULL,NULL,ts);
<a name="line1266">1266: </a>  <a href="../../../../docs/manualpages/SNES/SNESSetJacobian.html#SNESSetJacobian">SNESSetJacobian</a>(snes,NULL,NULL,NULL,ts);
<a name="line1267">1267: </a>  <font color="#4169E1">return</font>(0);
<a name="line1268">1268: </a>}

<a name="line1272">1272: </a><font color="#B22222">/*@C</font>
<a name="line1273">1273: </a><font color="#B22222">  <a href="../../../../docs/manualpages/TS/TSARKIMEXSetType.html#TSARKIMEXSetType">TSARKIMEXSetType</a> - Set the type of ARK IMEX scheme</font>

<a name="line1275">1275: </a><font color="#B22222">  Logically collective</font>

<a name="line1277">1277: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1278">1278: </a><font color="#B22222">+  ts - timestepping context</font>
<a name="line1279">1279: </a><font color="#B22222">-  arktype - type of ARK-IMEX scheme</font>

<a name="line1281">1281: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1283">1283: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEXGetType.html#TSARKIMEXGetType">TSARKIMEXGetType</a>(), <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEX2D.html#TSARKIMEX2D">TSARKIMEX2D</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEX2E.html#TSARKIMEX2E">TSARKIMEX2E</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEXPRSSP2.html#TSARKIMEXPRSSP2">TSARKIMEXPRSSP2</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEX3.html#TSARKIMEX3">TSARKIMEX3</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEXBPR3.html#TSARKIMEXBPR3">TSARKIMEXBPR3</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEXARS443.html#TSARKIMEXARS443">TSARKIMEXARS443</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEX4.html#TSARKIMEX4">TSARKIMEX4</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEX5.html#TSARKIMEX5">TSARKIMEX5</a></font>
<a name="line1284">1284: </a><font color="#B22222">@*/</font>
<a name="line1285">1285: </a><strong><font color="#4169E1"><a name="TSARKIMEXSetType"></a><a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../docs/manualpages/TS/TSARKIMEXSetType.html#TSARKIMEXSetType">TSARKIMEXSetType</a>(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/TS/TSARKIMEXType.html#TSARKIMEXType">TSARKIMEXType</a> arktype)</font></strong>
<a name="line1286">1286: </a>{

<a name="line1291">1291: </a>  PetscTryMethod(ts,<font color="#666666">"TSARKIMEXSetType_C"</font>,(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>,<a href="../../../../docs/manualpages/TS/TSARKIMEXType.html#TSARKIMEXType">TSARKIMEXType</a>),(ts,arktype));
<a name="line1292">1292: </a>  <font color="#4169E1">return</font>(0);
<a name="line1293">1293: </a>}

<a name="line1297">1297: </a><font color="#B22222">/*@C</font>
<a name="line1298">1298: </a><font color="#B22222">  <a href="../../../../docs/manualpages/TS/TSARKIMEXGetType.html#TSARKIMEXGetType">TSARKIMEXGetType</a> - Get the type of ARK IMEX scheme</font>

<a name="line1300">1300: </a><font color="#B22222">  Logically collective</font>

<a name="line1302">1302: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1303">1303: </a><font color="#B22222">.  ts - timestepping context</font>

<a name="line1305">1305: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1306">1306: </a><font color="#B22222">.  arktype - type of ARK-IMEX scheme</font>

<a name="line1308">1308: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1310">1310: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEXGetType.html#TSARKIMEXGetType">TSARKIMEXGetType</a>()</font>
<a name="line1311">1311: </a><font color="#B22222">@*/</font>
<a name="line1312">1312: </a><strong><font color="#4169E1"><a name="TSARKIMEXGetType"></a><a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../docs/manualpages/TS/TSARKIMEXGetType.html#TSARKIMEXGetType">TSARKIMEXGetType</a>(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/TS/TSARKIMEXType.html#TSARKIMEXType">TSARKIMEXType</a> *arktype)</font></strong>
<a name="line1313">1313: </a>{

<a name="line1318">1318: </a>  PetscUseMethod(ts,<font color="#666666">"TSARKIMEXGetType_C"</font>,(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>,<a href="../../../../docs/manualpages/TS/TSARKIMEXType.html#TSARKIMEXType">TSARKIMEXType</a>*),(ts,arktype));
<a name="line1319">1319: </a>  <font color="#4169E1">return</font>(0);
<a name="line1320">1320: </a>}

<a name="line1324">1324: </a><font color="#B22222">/*@</font>
<a name="line1325">1325: </a><font color="#B22222">  <a href="../../../../docs/manualpages/TS/TSARKIMEXSetFullyImplicit.html#TSARKIMEXSetFullyImplicit">TSARKIMEXSetFullyImplicit</a> - Solve both parts of the equation implicitly</font>

<a name="line1327">1327: </a><font color="#B22222">  Logically collective</font>

<a name="line1329">1329: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1330">1330: </a><font color="#B22222">+  ts - timestepping context</font>
<a name="line1331">1331: </a><font color="#B22222">-  flg - <a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a> for fully implicit</font>

<a name="line1333">1333: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1335">1335: </a><font color="#B22222">.seealso: <a href="../../../../docs/manualpages/TS/TSARKIMEXGetType.html#TSARKIMEXGetType">TSARKIMEXGetType</a>()</font>
<a name="line1336">1336: </a><font color="#B22222">@*/</font>
<a name="line1337">1337: </a><strong><font color="#4169E1"><a name="TSARKIMEXSetFullyImplicit"></a><a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> <a href="../../../../docs/manualpages/TS/TSARKIMEXSetFullyImplicit.html#TSARKIMEXSetFullyImplicit">TSARKIMEXSetFullyImplicit</a>(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> flg)</font></strong>
<a name="line1338">1338: </a>{

<a name="line1343">1343: </a>  PetscTryMethod(ts,<font color="#666666">"TSARKIMEXSetFullyImplicit_C"</font>,(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>,<a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>),(ts,flg));
<a name="line1344">1344: </a>  <font color="#4169E1">return</font>(0);
<a name="line1345">1345: </a>}

<a name="line1349">1349: </a><strong><font color="#4169E1"><a name="TSARKIMEXGetType_ARKIMEX"></a><a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  TSARKIMEXGetType_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/TS/TSARKIMEXType.html#TSARKIMEXType">TSARKIMEXType</a> *arktype)</font></strong>
<a name="line1350">1350: </a>{
<a name="line1351">1351: </a>  TS_ARKIMEX     *ark = (TS_ARKIMEX*)ts-&gt;data;

<a name="line1355">1355: </a>  <font color="#4169E1">if</font> (!ark-&gt;tableau) {
<a name="line1356">1356: </a>    <a href="../../../../docs/manualpages/TS/TSARKIMEXSetType.html#TSARKIMEXSetType">TSARKIMEXSetType</a>(ts,TSARKIMEXDefault);
<a name="line1357">1357: </a>  }
<a name="line1358">1358: </a>  *arktype = ark-&gt;tableau-&gt;name;
<a name="line1359">1359: </a>  <font color="#4169E1">return</font>(0);
<a name="line1360">1360: </a>}
<a name="line1363">1363: </a><strong><font color="#4169E1"><a name="TSARKIMEXSetType_ARKIMEX"></a><a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  TSARKIMEXSetType_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/TS/TSARKIMEXType.html#TSARKIMEXType">TSARKIMEXType</a> arktype)</font></strong>
<a name="line1364">1364: </a>{
<a name="line1365">1365: </a>  TS_ARKIMEX     *ark = (TS_ARKIMEX*)ts-&gt;data;
<a name="line1367">1367: </a>  <a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>      match;
<a name="line1368">1368: </a>  ARKTableauLink link;

<a name="line1371">1371: </a>  <font color="#4169E1">if</font> (ark-&gt;tableau) {
<a name="line1372">1372: </a>    <a href="../../../../docs/manualpages/Sys/PetscStrcmp.html#PetscStrcmp">PetscStrcmp</a>(ark-&gt;tableau-&gt;name,arktype,&amp;match);
<a name="line1373">1373: </a>    <font color="#4169E1">if</font> (match) <font color="#4169E1">return</font>(0);
<a name="line1374">1374: </a>  }
<a name="line1375">1375: </a>  <font color="#4169E1">for</font> (link = ARKTableauList; link; link=link-&gt;next) {
<a name="line1376">1376: </a>    <a href="../../../../docs/manualpages/Sys/PetscStrcmp.html#PetscStrcmp">PetscStrcmp</a>(link-&gt;tab.name,arktype,&amp;match);
<a name="line1377">1377: </a>    <font color="#4169E1">if</font> (match) {
<a name="line1378">1378: </a>      TSReset_ARKIMEX(ts);
<a name="line1379">1379: </a>      ark-&gt;tableau = &amp;link-&gt;tab;
<a name="line1380">1380: </a>      <font color="#4169E1">return</font>(0);
<a name="line1381">1381: </a>    }
<a name="line1382">1382: </a>  }
<a name="line1383">1383: </a>  <a href="../../../../docs/manualpages/Sys/SETERRQ1.html#SETERRQ1">SETERRQ1</a>(<a href="../../../../docs/manualpages/Sys/PetscObjectComm.html#PetscObjectComm">PetscObjectComm</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts),PETSC_ERR_ARG_UNKNOWN_TYPE,<font color="#666666">"Could not find '%s'"</font>,arktype);
<a name="line1384">1384: </a>  <font color="#4169E1">return</font>(0);
<a name="line1385">1385: </a>}
<a name="line1388">1388: </a><strong><font color="#4169E1"><a name="TSARKIMEXSetFullyImplicit_ARKIMEX"></a><a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a>  TSARKIMEXSetFullyImplicit_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts,<a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a> flg)</font></strong>
<a name="line1389">1389: </a>{
<a name="line1390">1390: </a>  TS_ARKIMEX *ark = (TS_ARKIMEX*)ts-&gt;data;

<a name="line1393">1393: </a>  ark-&gt;imex = (<a href="../../../../docs/manualpages/Sys/PetscBool.html#PetscBool">PetscBool</a>)!flg;
<a name="line1394">1394: </a>  <font color="#4169E1">return</font>(0);
<a name="line1395">1395: </a>}

<a name="line1397">1397: </a><font color="#B22222">/* ------------------------------------------------------------ */</font>
<a name="line1398">1398: </a><font color="#B22222">/*MC</font>
<a name="line1399">1399: </a><font color="#B22222">      <a href="../../../../docs/manualpages/TS/TSARKIMEX.html#TSARKIMEX">TSARKIMEX</a> - ODE and DAE solver using Additive Runge-Kutta IMEX schemes</font>

<a name="line1401">1401: </a><font color="#B22222">  These methods are intended for problems with well-separated time scales, especially when a slow scale is strongly</font>
<a name="line1402">1402: </a><font color="#B22222">  nonlinear such that it is expensive to solve with a fully implicit method. The user should provide the stiff part</font>
<a name="line1403">1403: </a><font color="#B22222">  of the equation using <a href="../../../../docs/manualpages/TS/TSSetIFunction.html#TSSetIFunction">TSSetIFunction</a>() and the non-stiff part with <a href="../../../../docs/manualpages/TS/TSSetRHSFunction.html#TSSetRHSFunction">TSSetRHSFunction</a>().</font>

<a name="line1405">1405: </a><font color="#B22222">  Notes:</font>
<a name="line1406">1406: </a><font color="#B22222">  The default is <a href="../../../../docs/manualpages/TS/TSARKIMEX3.html#TSARKIMEX3">TSARKIMEX3</a>, it can be changed with <a href="../../../../docs/manualpages/TS/TSARKIMEXSetType.html#TSARKIMEXSetType">TSARKIMEXSetType</a>() or -ts_arkimex_type</font>

<a name="line1408">1408: </a><font color="#B22222">  If the equation is implicit or a DAE, then <a href="../../../../docs/manualpages/TS/TSSetEquationType.html#TSSetEquationType">TSSetEquationType</a>() needs to be set accordingly. Refer to the manual for further information. </font>

<a name="line1410">1410: </a><font color="#B22222">  Methods with an explicit stage can only be used with ODE in which the stiff part G(t,X,Xdot) has the form Xdot + Ghat(t,X).</font>

<a name="line1412">1412: </a><font color="#B22222">  Consider trying <a href="../../../../docs/manualpages/TS/TSROSW.html#TSROSW">TSROSW</a> if the stiff part is linear or weakly nonlinear.</font>

<a name="line1414">1414: </a><font color="#B22222">  Level: beginner</font>

<a name="line1416">1416: </a><font color="#B22222">.seealso:  <a href="../../../../docs/manualpages/TS/TSCreate.html#TSCreate">TSCreate</a>(), <a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a>, <a href="../../../../docs/manualpages/TS/TSSetType.html#TSSetType">TSSetType</a>(), <a href="../../../../docs/manualpages/TS/TSARKIMEXSetType.html#TSARKIMEXSetType">TSARKIMEXSetType</a>(), <a href="../../../../docs/manualpages/TS/TSARKIMEXGetType.html#TSARKIMEXGetType">TSARKIMEXGetType</a>(), <a href="../../../../docs/manualpages/TS/TSARKIMEXSetFullyImplicit.html#TSARKIMEXSetFullyImplicit">TSARKIMEXSetFullyImplicit</a>(), <a href="../../../../docs/manualpages/TS/TSARKIMEX1BEE.html#TSARKIMEX1BEE">TSARKIMEX1BEE</a>,</font>
<a name="line1417">1417: </a><font color="#B22222">           <a href="../../../../docs/manualpages/TS/TSARKIMEX2C.html#TSARKIMEX2C">TSARKIMEX2C</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEX2D.html#TSARKIMEX2D">TSARKIMEX2D</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEX2E.html#TSARKIMEX2E">TSARKIMEX2E</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEX3.html#TSARKIMEX3">TSARKIMEX3</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEXL2.html#TSARKIMEXL2">TSARKIMEXL2</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEXA2.html#TSARKIMEXA2">TSARKIMEXA2</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEXARS122.html#TSARKIMEXARS122">TSARKIMEXARS122</a>,</font>
<a name="line1418">1418: </a><font color="#B22222">           <a href="../../../../docs/manualpages/TS/TSARKIMEX4.html#TSARKIMEX4">TSARKIMEX4</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEX5.html#TSARKIMEX5">TSARKIMEX5</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEXPRSSP2.html#TSARKIMEXPRSSP2">TSARKIMEXPRSSP2</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEXARS443.html#TSARKIMEXARS443">TSARKIMEXARS443</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEXBPR3.html#TSARKIMEXBPR3">TSARKIMEXBPR3</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEXType.html#TSARKIMEXType">TSARKIMEXType</a>, <a href="../../../../docs/manualpages/TS/TSARKIMEXRegister.html#TSARKIMEXRegister">TSARKIMEXRegister</a>()</font>

<a name="line1420">1420: </a><font color="#B22222">M*/</font>
<a name="line1423">1423: </a><strong><font color="#4169E1"><a name="TSCreate_ARKIMEX"></a>PETSC_EXTERN <a href="../../../../docs/manualpages/Sys/PetscErrorCode.html#PetscErrorCode">PetscErrorCode</a> TSCreate_ARKIMEX(<a href="../../../../docs/manualpages/TS/TS.html#TS">TS</a> ts)</font></strong>
<a name="line1424">1424: </a>{
<a name="line1425">1425: </a>  TS_ARKIMEX     *th;

<a name="line1429">1429: </a>  <a href="../../../../docs/manualpages/TS/TSARKIMEXInitializePackage.html#TSARKIMEXInitializePackage">TSARKIMEXInitializePackage</a>();

<a name="line1431">1431: </a>  ts-&gt;ops-&gt;reset          = TSReset_ARKIMEX;
<a name="line1432">1432: </a>  ts-&gt;ops-&gt;destroy        = TSDestroy_ARKIMEX;
<a name="line1433">1433: </a>  ts-&gt;ops-&gt;view           = TSView_ARKIMEX;
<a name="line1434">1434: </a>  ts-&gt;ops-&gt;load           = TSLoad_ARKIMEX;
<a name="line1435">1435: </a>  ts-&gt;ops-&gt;setup          = TSSetUp_ARKIMEX;
<a name="line1436">1436: </a>  ts-&gt;ops-&gt;step           = TSStep_ARKIMEX;
<a name="line1437">1437: </a>  ts-&gt;ops-&gt;interpolate    = TSInterpolate_ARKIMEX;
<a name="line1438">1438: </a>  ts-&gt;ops-&gt;evaluatestep   = TSEvaluateStep_ARKIMEX;
<a name="line1439">1439: </a>  ts-&gt;ops-&gt;rollback       = TSRollBack_ARKIMEX;
<a name="line1440">1440: </a>  ts-&gt;ops-&gt;setfromoptions = TSSetFromOptions_ARKIMEX;
<a name="line1441">1441: </a>  ts-&gt;ops-&gt;snesfunction   = SNESTSFormFunction_ARKIMEX;
<a name="line1442">1442: </a>  ts-&gt;ops-&gt;snesjacobian   = SNESTSFormJacobian_ARKIMEX;

<a name="line1444">1444: </a>  <a href="../../../../docs/manualpages/Sys/PetscNewLog.html#PetscNewLog">PetscNewLog</a>(ts,&amp;th);
<a name="line1445">1445: </a>  ts-&gt;data = (void*)th;
<a name="line1446">1446: </a>  th-&gt;imex = <a href="../../../../docs/manualpages/Sys/PETSC_TRUE.html#PETSC_TRUE">PETSC_TRUE</a>;

<a name="line1448">1448: </a>  <a href="../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts,<font color="#666666">"TSARKIMEXGetType_C"</font>,TSARKIMEXGetType_ARKIMEX);
<a name="line1449">1449: </a>  <a href="../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts,<font color="#666666">"TSARKIMEXSetType_C"</font>,TSARKIMEXSetType_ARKIMEX);
<a name="line1450">1450: </a>  <a href="../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html#PetscObjectComposeFunction">PetscObjectComposeFunction</a>((<a href="../../../../docs/manualpages/Sys/PetscObject.html#PetscObject">PetscObject</a>)ts,<font color="#666666">"TSARKIMEXSetFullyImplicit_C"</font>,TSARKIMEXSetFullyImplicit_ARKIMEX);
<a name="line1451">1451: </a>  <font color="#4169E1">return</font>(0);
<a name="line1452">1452: </a>}
</pre>
</body>

</html>
